(()=>{var Xr=Object.create;var It=Object.defineProperty;var Vr=Object.getOwnPropertyDescriptor;var Kr=Object.getOwnPropertyNames;var Ur=Object.getPrototypeOf,Jr=Object.prototype.hasOwnProperty;var Zr=t=>It(t,"__esModule",{value:!0});var Rt=(t,i)=>()=>(i||t((i={exports:{}}).exports,i),i.exports);var Qr=(t,i,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of Kr(i))!Jr.call(t,l)&&l!=="default"&&It(t,l,{get:()=>i[l],enumerable:!(o=Vr(i,l))||o.enumerable});return t},Wt=t=>Qr(Zr(It(t!=null?Xr(Ur(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Er=Rt((Cn,Mr)=>{Mr.exports.default={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric"},null_value:-1}}}});var Or=Rt((An,Fe)=>{var Nr=Er().default;Fe.exports.get_types=function(){return Object.keys(Fe.exports.get_config().types)};Fe.exports.get_type_config=function(t){let i={};if(Fe.exports.get_config().types[t]&&Object.assign(i,Fe.exports.get_config().types[t]),i.type){let o=Fe.exports.get_type_config(i.type);return Object.assign(o,i),o}else return i};function Gt(t){return t&&typeof t=="object"&&!Array.isArray(t)}function Nt(t,...i){if(!i.length)return t;let o=i.shift();if(Gt(t)&&Gt(o))for(let l in o)Gt(o[l])?(t[l]||Object.assign(t,{[l]:{}}),Nt(t[l],o[l])):Object.assign(t,{[l]:o[l]});return Nt(t,...i)}window.__PERSPECTIVE_CONFIG__=void 0;Fe.exports.override_config=function(t){window.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),window.__PERSPECTIVE_CONFIG__=Nt(Nr,t)};Fe.exports.get_config=function(){return window.__PERSPECTIVE_CONFIG__||(window.__PERSPECTIVE_CONFIG__=Nt(Nr,window.__TEMPLATE_CONFIG__||{})),window.__PERSPECTIVE_CONFIG__}});var qt=Rt((_t,pt)=>{(function(){var t,i,o,l,d,u,_,v,p,k,x,z,I,P,Y,E,N,R,ee,m,J,se,H,D,ne,ae,pe,ce,Oe,Be,Ce,Ye,$e,re,je,Ae,Pe,fe,Le,Se,ze,De,ge,me,Me,Ue,Ee,ue,He,vt,Zt,B,Qt,er,tr,rr,le,nr,ir,sr,or,ar,lr,cr,Ct,At,St,fr,dr,ur,wt,yt,hr,be,_r,Je,we,Ft,Q,te,Ie,xt,kt,xe=[].slice;Q=function(){var e,r,n,s,a;for(e={},a="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),s=0,r=a.length;s<r;s++)n=a[s],e["[object "+n+"]"]=n.toLowerCase();return function(c){var f;return f=Object.prototype.toString.call(c),e[f]||"object"}}(),ue=function(e,r,n){return r==null&&(r=0),n==null&&(n=1),e<r&&(e=r),e>n&&(e=n),e},te=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},J=function(e){var r,n;for(e._clipped=!1,e._unclipped=e.slice(0),r=n=0;n<3;r=++n)r<3?((e[r]<0||e[r]>255)&&(e._clipped=!0),e[r]<0&&(e[r]=0),e[r]>255&&(e[r]=255)):r===3&&(e[r]<0&&(e[r]=0),e[r]>1&&(e[r]=1));return e._clipped||delete e._unclipped,e},l=Math.PI,be=Math.round,D=Math.cos,Oe=Math.floor,le=Math.pow,He=Math.log,Je=Math.sin,we=Math.sqrt,P=Math.atan2,B=Math.max,I=Math.abs,_=l*2,d=l/3,i=l/180,u=180/l,m=function(){return arguments[0]instanceof t?arguments[0]:function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,arguments,function(){})},m.default=m,z=[],typeof pt!="undefined"&&pt!==null&&pt.exports!=null&&(pt.exports=m),typeof define=="function"&&define.amd?define([],function(){return m}):(hr=typeof _t!="undefined"&&_t!==null?_t:this,hr.chroma=m),m.version="1.4.1",x={},p=[],k=!1,t=function(){function e(){var r,n,s,a,c,f,h,g,w;for(f=this,n=[],g=0,a=arguments.length;g<a;g++)r=arguments[g],r!=null&&n.push(r);if(n.length>1&&(h=n[n.length-1]),x[h]!=null)f._rgb=J(x[h](te(n.slice(0,-1))));else{for(k||(p=p.sort(function(L,S){return S.p-L.p}),k=!0),w=0,c=p.length;w<c&&(s=p[w],h=s.test.apply(s,n),!h);w++);h&&(f._rgb=J(x[h].apply(x,n)))}f._rgb==null&&console.warn("unknown format: "+n),f._rgb==null&&(f._rgb=[0,0,0]),f._rgb.length===3&&f._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),m._input=x;m.brewer=R={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,r;r=[];for(e in R)r.push(R[e.toLowerCase()]=R[e]);return r}(),Ie={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},m.colors=H=Ie,ge=function(){var e,r,n,s,a,c,f,h,g;return r=te(arguments),a=r[0],e=r[1],n=r[2],h=(a+16)/116,f=isNaN(e)?h:h+e/500,g=isNaN(n)?h:h-n/200,h=o.Yn*me(h),f=o.Xn*me(f),g=o.Zn*me(g),c=kt(3.2404542*f-1.5371385*h-.4985314*g),s=kt(-.969266*f+1.8760108*h+.041556*g),n=kt(.0556434*f-.2040259*h+1.0572252*g),[c,s,n,r.length>3?r[3]:1]},kt=function(e){return 255*(e<=.00304?12.92*e:1.055*le(e,1/2.4)-.055)},me=function(e){return e>o.t1?e*e*e:o.t2*(e-o.t0)},o={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ct=function(){var e,r,n,s,a,c,f,h;return s=te(arguments),n=s[0],r=s[1],e=s[2],a=ur(n,r,e),c=a[0],f=a[1],h=a[2],[116*f-16,500*(c-f),200*(f-h)]},wt=function(e){return(e/=255)<=.04045?e/12.92:le((e+.055)/1.055,2.4)},xt=function(e){return e>o.t3?le(e,1/3):e/o.t2+o.t0},ur=function(){var e,r,n,s,a,c,f;return s=te(arguments),n=s[0],r=s[1],e=s[2],n=wt(n),r=wt(r),e=wt(e),a=xt((.4124564*n+.3575761*r+.1804375*e)/o.Xn),c=xt((.2126729*n+.7151522*r+.072175*e)/o.Yn),f=xt((.0193339*n+.119192*r+.9503041*e)/o.Zn),[a,c,f]},m.lab=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["lab"]),function(){})},x.lab=ge,t.prototype.lab=function(){return Ct(this._rgb)},Y=function(e){var r,n,s,a,c,f,h,g,w,L,S;return e=function(){var M,y,O;for(O=[],y=0,M=e.length;y<M;y++)a=e[y],O.push(m(a));return O}(),e.length===2?(w=function(){var M,y,O;for(O=[],y=0,M=e.length;y<M;y++)a=e[y],O.push(a.lab());return O}(),c=w[0],f=w[1],r=function(M){var y,O;return O=function(){var A,j;for(j=[],y=A=0;A<=2;y=++A)j.push(c[y]+M*(f[y]-c[y]));return j}(),m.lab.apply(m,O)}):e.length===3?(L=function(){var M,y,O;for(O=[],y=0,M=e.length;y<M;y++)a=e[y],O.push(a.lab());return O}(),c=L[0],f=L[1],h=L[2],r=function(M){var y,O;return O=function(){var A,j;for(j=[],y=A=0;A<=2;y=++A)j.push((1-M)*(1-M)*c[y]+2*(1-M)*M*f[y]+M*M*h[y]);return j}(),m.lab.apply(m,O)}):e.length===4?(S=function(){var M,y,O;for(O=[],y=0,M=e.length;y<M;y++)a=e[y],O.push(a.lab());return O}(),c=S[0],f=S[1],h=S[2],g=S[3],r=function(M){var y,O;return O=function(){var A,j;for(j=[],y=A=0;A<=2;y=++A)j.push((1-M)*(1-M)*(1-M)*c[y]+3*(1-M)*(1-M)*M*f[y]+3*(1-M)*M*M*h[y]+M*M*M*g[y]);return j}(),m.lab.apply(m,O)}):e.length===5&&(n=Y(e.slice(0,3)),s=Y(e.slice(2,5)),r=function(M){return M<.5?n(M*2):s((M-.5)*2)}),r},m.bezier=function(e){var r;return r=Y(e),r.scale=function(){return m.scale(r)},r},m.cubehelix=function(e,r,n,s,a){var c,f,h;return e==null&&(e=300),r==null&&(r=-1.5),n==null&&(n=1),s==null&&(s=1),a==null&&(a=[0,1]),c=0,Q(a)==="array"?f=a[1]-a[0]:(f=0,a=[a,a]),h=function(g){var w,L,S,M,y,O,A,j,V;return w=_*((e+120)/360+r*g),A=le(a[0]+f*g,s),O=c!==0?n[0]+g*c:n,L=O*A*(1-A)/2,M=D(w),V=Je(w),j=A+L*(-.14861*M+1.78277*V),y=A+L*(-.29227*M-.90649*V),S=A+L*(1.97294*M),m(J([j*255,y*255,S*255,1]))},h.start=function(g){return g==null?e:(e=g,h)},h.rotations=function(g){return g==null?r:(r=g,h)},h.gamma=function(g){return g==null?s:(s=g,h)},h.hue=function(g){return g==null?n:(n=g,Q(n)==="array"?(c=n[1]-n[0],c===0&&(n=n[1])):c=0,h)},h.lightness=function(g){return g==null?a:(Q(g)==="array"?(a=g,f=g[1]-g[0]):(a=[g,g],f=0),h)},h.scale=function(){return m.scale(h)},h.hue(n),h},m.random=function(){var e,r,n,s;for(r="0123456789abcdef",e="#",n=s=0;s<6;n=++s)e+=r.charAt(Oe(Math.random()*16));return new t(e)},z=[],Ae=function(e,r,n,s){var a,c,f,h;for(n==null&&(n=.5),s==null&&(s="rgb"),Q(e)!=="object"&&(e=m(e)),Q(r)!=="object"&&(r=m(r)),f=0,c=z.length;f<c;f++)if(a=z[f],s===a[0]){h=a[1](e,r,n,s);break}if(h==null)throw"color mode "+s+" is not supported";return h.alpha(e.alpha()+n*(r.alpha()-e.alpha()))},m.interpolate=Ae,t.prototype.interpolate=function(e,r,n){return Ae(this,e,r,n)},m.mix=Ae,t.prototype.mix=t.prototype.interpolate,x.rgb=function(){var e,r,n,s;r=te(arguments),n=[];for(e in r)s=r[e],n.push(s);return n},m.rgb=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(e){return e==null&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(e){return e==null&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},p.push({p:3,test:function(e){var r;if(r=te(arguments),Q(r)==="array"&&r.length===3||r.length===4&&Q(r[3])==="number"&&r[3]>=0&&r[3]<=1)return"rgb"}}),x.lrgb=x.rgb,Le=function(e,r,n,s){var a,c;return a=e._rgb,c=r._rgb,new t(we(le(a[0],2)*(1-n)+le(c[0],2)*n),we(le(a[1],2)*(1-n)+le(c[1],2)*n),we(le(a[2],2)*(1-n)+le(c[2],2)*n),s)},v=function(e){var r,n,s,a,c,f;for(n=1/e.length,f=[0,0,0,0],a=0,s=e.length;a<s;a++)r=e[a],c=r._rgb,f[0]+=le(c[0],2)*n,f[1]+=le(c[1],2)*n,f[2]+=le(c[2],2)*n,f[3]+=c[3]*n;return f[0]=we(f[0]),f[1]=we(f[1]),f[2]=we(f[2]),f[3]>1&&(f[3]=1),new t(J(f))},z.push(["lrgb",Le]),m.average=function(e,r){var n,s,a,c,f,h,g,w,L,S,M,y,O;if(r==null&&(r="rgb"),L=e.length,e=e.map(function(A){return m(A)}),g=e.splice(0,1)[0],r==="lrgb")return v(e);y=g.get(r),c=[],f=0,h=0;for(w in y)y[w]=y[w]||0,c.push(isNaN(y[w])?0:1),r.charAt(w)==="h"&&!isNaN(y[w])&&(n=y[w]/180*l,f+=D(n),h+=Je(n));for(s=g.alpha(),M=0,S=e.length;M<S;M++){a=e[M],O=a.get(r),s+=a.alpha();for(w in y)isNaN(O[w])||(c[w]+=1,r.charAt(w)==="h"?(n=O[w]/180*l,f+=D(n),h+=Je(n)):y[w]+=O[w])}for(w in y)if(r.charAt(w)==="h"){for(n=P(h/c[w],f/c[w])/l*180;n<0;)n+=360;for(;n>=360;)n-=360;y[w]=n}else y[w]=y[w]/c[w];return m(y,r).alpha(s/L)},Ce=function(e){var r,n,s,a,c,f;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),f=parseInt(e,16),a=f>>16,s=f>>8&255,n=f&255,[a,s,n,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return e.length===9&&(e=e.substr(1)),f=parseInt(e,16),a=f>>24&255,s=f>>16&255,n=f>>8&255,r=be((f&255)/255*100)/100,[a,s,n,r];if(x.css!=null&&(c=x.css(e)))return c;throw"unknown color: "+e},or=function(e,r){var n,s,a,c,f,h,g;return r==null&&(r="auto"),f=e[0],a=e[1],s=e[2],n=e[3],r==="auto"&&(r=n<1?"rgba":"rgb"),f=Math.round(f),a=Math.round(a),s=Math.round(s),g=f<<16|a<<8|s,h="000000"+g.toString(16),h=h.substr(h.length-6),c="0"+be(n*255).toString(16),c=c.substr(c.length-2),"#"+function(){switch(r.toLowerCase()){case"rgba":return h+c;case"argb":return c+h;default:return h}}()},x.hex=function(e){return Ce(e)},m.hex=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(e){return e==null&&(e="auto"),or(this._rgb,e)},p.push({p:4,test:function(e){if(arguments.length===1&&Q(e)==="string")return"hex"}}),re=function(){var e,r,n,s,a,c,f,h,g,w,L,S,M,y;if(e=te(arguments),a=e[0],L=e[1],f=e[2],L===0)g=s=r=f*255;else{for(y=[0,0,0],n=[0,0,0],M=f<.5?f*(1+L):f+L-f*L,S=2*f-M,a/=360,y[0]=a+1/3,y[1]=a,y[2]=a-1/3,c=h=0;h<=2;c=++h)y[c]<0&&(y[c]+=1),y[c]>1&&(y[c]-=1),6*y[c]<1?n[c]=S+(M-S)*6*y[c]:2*y[c]<1?n[c]=M:3*y[c]<2?n[c]=S+(M-S)*(2/3-y[c])*6:n[c]=S;w=[be(n[0]*255),be(n[1]*255),be(n[2]*255)],g=w[0],s=w[1],r=w[2]}return e.length>3?[g,s,r,e[3]]:[g,s,r]},lr=function(e,r,n){var s,a,c,f,h;return e!==void 0&&e.length>=3&&(f=e,e=f[0],r=f[1],n=f[2]),e/=255,r/=255,n/=255,c=Math.min(e,r,n),B=Math.max(e,r,n),a=(B+c)/2,B===c?(h=0,s=Number.NaN):h=a<.5?(B-c)/(B+c):(B-c)/(2-B-c),e===B?s=(r-n)/(B-c):r===B?s=2+(n-e)/(B-c):n===B&&(s=4+(e-r)/(B-c)),s*=60,s<0&&(s+=360),[s,h,a]},m.hsl=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["hsl"]),function(){})},x.hsl=re,t.prototype.hsl=function(){return lr(this._rgb)},je=function(){var e,r,n,s,a,c,f,h,g,w,L,S,M,y,O,A,j,V;if(e=te(arguments),a=e[0],A=e[1],V=e[2],V*=255,A===0)g=s=r=V;else switch(a===360&&(a=0),a>360&&(a-=360),a<0&&(a+=360),a/=60,c=Oe(a),n=a-c,f=V*(1-A),h=V*(1-A*n),j=V*(1-A*(1-n)),c){case 0:w=[V,j,f],g=w[0],s=w[1],r=w[2];break;case 1:L=[h,V,f],g=L[0],s=L[1],r=L[2];break;case 2:S=[f,V,j],g=S[0],s=S[1],r=S[2];break;case 3:M=[f,h,V],g=M[0],s=M[1],r=M[2];break;case 4:y=[j,f,V],g=y[0],s=y[1],r=y[2];break;case 5:O=[V,f,h],g=O[0],s=O[1],r=O[2]}return[g,s,r,e.length>3?e[3]:1]},cr=function(){var e,r,n,s,a,c,f,h,g;return f=te(arguments),c=f[0],n=f[1],e=f[2],a=Math.min(c,n,e),B=Math.max(c,n,e),r=B-a,g=B/255,B===0?(s=Number.NaN,h=0):(h=r/B,c===B&&(s=(n-e)/r),n===B&&(s=2+(e-c)/r),e===B&&(s=4+(c-n)/r),s*=60,s<0&&(s+=360)),[s,h,g]},m.hsv=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["hsv"]),function(){})},x.hsv=je,t.prototype.hsv=function(){return cr(this._rgb)},tr=function(e){var r,n,s;return Q(e)==="number"&&e>=0&&e<=16777215?(s=e>>16,n=e>>8&255,r=e&255,[s,n,r,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},fr=function(){var e,r,n,s;return s=te(arguments),n=s[0],r=s[1],e=s[2],(n<<16)+(r<<8)+e},m.num=function(e){return new t(e,"num")},t.prototype.num=function(e){return e==null&&(e="rgb"),fr(this._rgb,e)},x.num=tr,p.push({p:1,test:function(e){if(arguments.length===1&&Q(e)==="number"&&e>=0&&e<=16777215)return"num"}}),Be=function(){var e,r,n,s,a,c,f,h,g,w,L,S,M,y,O,A,j,V,ie,F;if(n=te(arguments),h=n[0],a=n[1],r=n[2],a=a/100,f=f/100*255,e=a*255,a===0)S=f=s=r;else switch(h===360&&(h=0),h>360&&(h-=360),h<0&&(h+=360),h/=60,g=Oe(h),c=h-g,w=r*(1-a),L=w+e*(1-c),ie=w+e*c,F=w+e,g){case 0:M=[F,ie,w],S=M[0],f=M[1],s=M[2];break;case 1:y=[L,F,w],S=y[0],f=y[1],s=y[2];break;case 2:O=[w,F,ie],S=O[0],f=O[1],s=O[2];break;case 3:A=[w,L,F],S=A[0],f=A[1],s=A[2];break;case 4:j=[ie,w,F],S=j[0],f=j[1],s=j[2];break;case 5:V=[F,w,L],S=V[0],f=V[1],s=V[2]}return[S,f,s,n.length>3?n[3]:1]},sr=function(){var e,r,n,s,a,c,f,h,g;return g=te(arguments),h=g[0],a=g[1],r=g[2],f=Math.min(h,a,r),B=Math.max(h,a,r),s=B-f,n=s*100/255,e=f/(255-s)*100,s===0?c=Number.NaN:(h===B&&(c=(a-r)/s),a===B&&(c=2+(r-h)/s),r===B&&(c=4+(h-a)/s),c*=60,c<0&&(c+=360)),[c,n,e]},m.hcg=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["hcg"]),function(){})},x.hcg=Be,t.prototype.hcg=function(){return sr(this._rgb)},ne=function(e){var r,n,s,a,c,f,h,g;if(e=e.toLowerCase(),m.colors!=null&&m.colors[e])return Ce(m.colors[e]);if(c=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(h=c.slice(1,4),a=f=0;f<=2;a=++f)h[a]=+h[a];h[3]=1}else if(c=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(h=c.slice(1,5),a=g=0;g<=3;a=++g)h[a]=+h[a];else if(c=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(h=c.slice(1,4),a=r=0;r<=2;a=++r)h[a]=be(h[a]*2.55);h[3]=1}else if(c=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(h=c.slice(1,5),a=n=0;n<=2;a=++n)h[a]=be(h[a]*2.55);h[3]=+h[3]}else(c=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(s=c.slice(1,4),s[1]*=.01,s[2]*=.01,h=re(s),h[3]=1):(c=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(s=c.slice(1,4),s[1]*=.01,s[2]*=.01,h=re(s),h[3]=+c[4]);return h},ir=function(e){var r;if(r=e[3]<1?"rgba":"rgb",r==="rgb")return r+"("+e.slice(0,3).map(be).join(",")+")";if(r==="rgba")return r+"("+e.slice(0,3).map(be).join(",")+","+e[3]+")"},yt=function(e){return be(e*100)/100},$e=function(e,r){var n;return n=r<1?"hsla":"hsl",e[0]=yt(e[0]||0),e[1]=yt(e[1]*100)+"%",e[2]=yt(e[2]*100)+"%",n==="hsla"&&(e[3]=r),n+"("+e.join(",")+")"},x.css=function(e){return ne(e)},m.css=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(e){if(e==null&&(e="rgb"),e.slice(0,3)==="rgb")return ir(this._rgb);if(e.slice(0,3)==="hsl")return $e(this.hsl(),this.alpha())},x.named=function(e){return Ce(Ie[e])},p.push({p:5,test:function(e){if(arguments.length===1&&Ie[e]!=null)return"named"}}),t.prototype.name=function(e){var r,n;arguments.length&&(Ie[e]&&(this._rgb=Ce(Ie[e])),this._rgb[3]=1),r=this.hex("rgb");for(n in Ie)if(r===Ie[n])return n;return r},Me=function(){var e,r,n,s;return s=te(arguments),n=s[0],e=s[1],r=s[2],r=r*i,[n,D(r)*e,Je(r)*e]},Ue=function(){var e,r,n,s,a,c,f,h,g,w,L;return n=te(arguments),h=n[0],a=n[1],f=n[2],w=Me(h,a,f),e=w[0],r=w[1],s=w[2],L=ge(e,r,s),g=L[0],c=L[1],s=L[2],[g,c,s,n.length>3?n[3]:1]},De=function(){var e,r,n,s,a,c;return c=te(arguments),a=c[0],e=c[1],r=c[2],n=we(e*e+r*r),s=(P(r,e)*u+360)%360,be(n*1e4)===0&&(s=Number.NaN),[a,n,s]},At=function(){var e,r,n,s,a,c,f;return c=te(arguments),a=c[0],n=c[1],r=c[2],f=Ct(a,n,r),s=f[0],e=f[1],r=f[2],De(s,e,r)},m.lch=function(){var e;return e=te(arguments),new t(e,"lch")},m.hcl=function(){var e;return e=te(arguments),new t(e,"hcl")},x.lch=Ue,x.hcl=function(){var e,r,n,s;return s=te(arguments),r=s[0],e=s[1],n=s[2],Ue([n,e,r])},t.prototype.lch=function(){return At(this._rgb)},t.prototype.hcl=function(){return At(this._rgb).reverse()},nr=function(e){var r,n,s,a,c,f,h,g,w;return e==null&&(e="rgb"),g=te(arguments),h=g[0],a=g[1],r=g[2],h=h/255,a=a/255,r=r/255,c=1-Math.max(h,Math.max(a,r)),s=c<1?1/(1-c):0,n=(1-h-c)*s,f=(1-a-c)*s,w=(1-r-c)*s,[n,f,w,c]},se=function(){var e,r,n,s,a,c,f,h,g;return r=te(arguments),s=r[0],f=r[1],g=r[2],c=r[3],e=r.length>4?r[4]:1,c===1?[0,0,0,e]:(h=s>=1?0:255*(1-s)*(1-c),a=f>=1?0:255*(1-f)*(1-c),n=g>=1?0:255*(1-g)*(1-c),[h,a,n,e])},x.cmyk=function(){return se(te(arguments))},m.cmyk=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return nr(this._rgb)},x.gl=function(){var e,r,n,s,a;for(s=function(){var c,f;c=te(arguments),f=[];for(r in c)a=c[r],f.push(a);return f}.apply(this,arguments),e=n=0;n<=2;e=++n)s[e]*=255;return s},m.gl=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},St=function(e,r,n){var s;return s=te(arguments),e=s[0],r=s[1],n=s[2],e=vt(e),r=vt(r),n=vt(n),.2126*e+.7152*r+.0722*n},vt=function(e){return e/=255,e<=.03928?e/12.92:le((e+.055)/1.055,2.4)},ze=function(e,r,n,s){var a,c;return a=e._rgb,c=r._rgb,new t(a[0]+n*(c[0]-a[0]),a[1]+n*(c[1]-a[1]),a[2]+n*(c[2]-a[2]),s)},z.push(["rgb",ze]),t.prototype.luminance=function(e,r){var n,s,a,c,f;return r==null&&(r="rgb"),arguments.length?(c=this._rgb,e===0?c=[0,0,0,this._rgb[3]]:e===1?c=[255,255,255,this[3]]:(n=St(this._rgb),s=1e-7,a=20,f=function(h,g){var w,L;return L=h.interpolate(g,.5,r),w=L.luminance(),Math.abs(e-w)<s||!a--?L:w>e?f(h,L):f(L,g)},n>e?c=f(m("black"),this).rgba():c=f(this,m("white")).rgba()),m(c).alpha(this.alpha())):St(this._rgb)},Ft=function(e){var r,n,s,a;return a=e/100,a<66?(s=255,n=-155.25485562709179-.44596950469579133*(n=a-2)+104.49216199393888*He(n),r=a<20?0:-254.76935184120902+.8274096064007395*(r=a-10)+115.67994401066147*He(r)):(s=351.97690566805693+.114206453784165*(s=a-55)-40.25366309332127*He(s),n=325.4494125711974+.07943456536662342*(n=a-50)-28.0852963507957*He(n),r=255),[s,n,r]},dr=function(){var e,r,n,s,a,c,f,h,g;for(f=te(arguments),c=f[0],n=f[1],e=f[2],a=1e3,s=4e4,r=.4;s-a>r;)g=(s+a)*.5,h=Ft(g),h[2]/h[0]>=e/c?s=g:a=g;return be(g)},m.temperature=m.kelvin=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["temperature"]),function(){})},x.temperature=x.kelvin=x.K=Ft,t.prototype.temperature=function(){return dr(this._rgb)},t.prototype.kelvin=t.prototype.temperature,m.contrast=function(e,r){var n,s,a,c;return((a=Q(e))==="string"||a==="number")&&(e=new t(e)),((c=Q(r))==="string"||c==="number")&&(r=new t(r)),n=e.luminance(),s=r.luminance(),n>s?(n+.05)/(s+.05):(s+.05)/(n+.05)},m.distance=function(e,r,n){var s,a,c,f,h,g,w;n==null&&(n="lab"),((h=Q(e))==="string"||h==="number")&&(e=new t(e)),((g=Q(r))==="string"||g==="number")&&(r=new t(r)),c=e.get(n),f=r.get(n),w=0;for(a in c)s=(c[a]||0)-(f[a]||0),w+=s*s;return Math.sqrt(w)},m.deltaE=function(e,r,n,s){var a,c,f,h,g,w,L,S,M,y,O,A,j,V,ie,F,ke,ve,G,K,he,b,C,T,q,W,$;for(n==null&&(n=1),s==null&&(s=1),((ke=Q(e))==="string"||ke==="number")&&(e=new t(e)),((ve=Q(r))==="string"||ve==="number")&&(r=new t(r)),G=e.lab(),a=G[0],f=G[1],g=G[2],K=r.lab(),c=K[0],h=K[1],w=K[2],L=we(f*f+g*g),S=we(h*h+w*w),C=a<16?.511:.040975*a/(1+.01765*a),he=.0638*L/(1+.0131*L)+.638,F=L<1e-6?0:P(g,f)*180/l;F<0;)F+=360;for(;F>=360;)F-=360;return T=F>=164&&F<=345?.56+I(.2*D(l*(F+168)/180)):.36+I(.4*D(l*(F+35)/180)),M=L*L*L*L,ie=we(M/(M+1900)),b=he*(ie*T+1-ie),V=a-c,j=L-S,O=f-h,A=g-w,y=O*O+A*A-j*j,q=V/(n*C),W=j/(s*he),$=b,we(q*q+W*W+y/($*$))},t.prototype.get=function(e){var r,n,s,a,c,f;return s=this,c=e.split("."),a=c[0],r=c[1],f=s[a](),r?(n=a.indexOf(r),n>-1?f[n]:console.warn("unknown channel "+r+" in mode "+a)):f},t.prototype.set=function(e,r){var n,s,a,c,f,h;if(a=this,f=e.split("."),c=f[0],n=f[1],n)if(h=a[c](),s=c.indexOf(n),s>-1)if(Q(r)==="string")switch(r.charAt(0)){case"+":h[s]+=+r;break;case"-":h[s]+=+r;break;case"*":h[s]*=+r.substr(1);break;case"/":h[s]/=+r.substr(1);break;default:h[s]=+r}else h[s]=r;else console.warn("unknown channel "+n+" in mode "+c);else h=r;return m(h,c).alpha(a.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(e){return arguments.length?m.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},t.prototype.darken=function(e){var r,n;return e==null&&(e=1),n=this,r=n.lab(),r[0]-=o.Kn*e,m.lab(r).alpha(n.alpha())},t.prototype.brighten=function(e){return e==null&&(e=1),this.darken(-e)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(e){var r,n;return e==null&&(e=1),n=this,r=n.lch(),r[1]+=e*o.Kn,r[1]<0&&(r[1]=0),m.lch(r).alpha(n.alpha())},t.prototype.desaturate=function(e){return e==null&&(e=1),this.saturate(-e)},t.prototype.premultiply=function(){var e,r;return r=this.rgb(),e=this.alpha(),m(r[0]*e,r[1]*e,r[2]*e,e)},E=function(e,r,n){if(!E[n])throw"unknown blend mode "+n;return E[n](e,r)},N=function(e){return function(r,n){var s,a;return s=m(n).rgb(),a=m(r).rgb(),m(e(s,a),"rgb")}},ce=function(e){return function(r,n){var s,a,c;for(c=[],s=a=0;a<=3;s=++a)c[s]=e(r[s],n[s]);return c}},er=function(e,r){return e},Qt=function(e,r){return e*r/255},ae=function(e,r){return e>r?r:e},Ee=function(e,r){return e>r?e:r},_r=function(e,r){return 255*(1-(1-e/255)*(1-r/255))},rr=function(e,r){return r<128?2*e*r/255:255*(1-2*(1-e/255)*(1-r/255))},ee=function(e,r){return 255*(1-(1-r/255)/(e/255))},pe=function(e,r){return e===255||(e=255*(r/255)/(1-e/255),e>255)?255:e},E.normal=N(ce(er)),E.multiply=N(ce(Qt)),E.screen=N(ce(_r)),E.overlay=N(ce(rr)),E.darken=N(ce(ae)),E.lighten=N(ce(Ee)),E.dodge=N(ce(pe)),E.burn=N(ce(ee)),m.blend=E,m.analyze=function(e){var r,n,s,a;for(s={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},n=0,r=e.length;n<r;n++)a=e[n],a!=null&&!isNaN(a)&&(s.values.push(a),s.sum+=a,a<s.min&&(s.min=a),a>s.max&&(s.max=a),s.count+=1);return s.domain=[s.min,s.max],s.limits=function(c,f){return m.limits(s,c,f)},s},m.scale=function(e,r){var n,s,a,c,f,h,g,w,L,S,M,y,O,A,j,V,ie,F,ke,ve,G,K,he;return S="rgb",M=m("#ccc"),j=0,h=!1,f=[0,1],A=[],O=[0,0],n=!1,a=[],y=!1,L=0,w=1,c=!1,s={},V=!0,g=1,K=function(b){var C,T,q,W,$,Z;if(b==null&&(b=["#fff","#000"]),b!=null&&Q(b)==="string"&&m.brewer!=null&&(b=m.brewer[b]||m.brewer[b.toLowerCase()]||b),Q(b)==="array"){for(b.length===1&&(b=[b[0],b[0]]),b=b.slice(0),C=q=0,W=b.length-1;0<=W?q<=W:q>=W;C=0<=W?++q:--q)T=b[C],Q(T)==="string"&&(b[C]=m(T));for(A.length=0,C=Z=0,$=b.length-1;0<=$?Z<=$:Z>=$;C=0<=$?++Z:--Z)A.push(C/(b.length-1))}return G(),a=b},ke=function(b){var C,T;if(n!=null){for(T=n.length-1,C=0;C<T&&b>=n[C];)C++;return C-1}return 0},he=function(b){return b},ie=function(b){var C,T,q,W,$;return $=b,n.length>2&&(W=n.length-1,C=ke(b),q=n[0]+(n[1]-n[0])*(0+j*.5),T=n[W-1]+(n[W]-n[W-1])*(1-j*.5),$=L+(n[C]+(n[C+1]-n[C])*.5-q)/(T-q)*(w-L)),$},ve=function(b,C){var T,q,W,$,Z,U,oe,X;if(C==null&&(C=!1),isNaN(b)||b===null)return M;if(C?X=b:n&&n.length>2?(T=ke(b),X=T/(n.length-2)):w!==L?X=(b-L)/(w-L):X=1,C||(X=he(X)),g!==1&&(X=le(X,g)),X=O[0]+X*(1-O[0]-O[1]),X=Math.min(1,Math.max(0,X)),$=Math.floor(X*1e4),V&&s[$])q=s[$];else{if(Q(a)==="array")for(W=Z=0,oe=A.length-1;0<=oe?Z<=oe:Z>=oe;W=0<=oe?++Z:--Z){if(U=A[W],X<=U){q=a[W];break}if(X>=U&&W===A.length-1){q=a[W];break}if(X>U&&X<A[W+1]){X=(X-U)/(A[W+1]-U),q=m.interpolate(a[W],a[W+1],X,S);break}}else Q(a)==="function"&&(q=a(X));V&&(s[$]=q)}return q},G=function(){return s={}},K(e),F=function(b){var C;return C=m(ve(b)),y&&C[y]?C[y]():C},F.classes=function(b){var C;return b!=null?(Q(b)==="array"?(n=b,f=[b[0],b[b.length-1]]):(C=m.analyze(f),b===0?n=[C.min,C.max]:n=m.limits(C,"e",b)),F):n},F.domain=function(b){var C,T,q,W,$,Z,U;if(!arguments.length)return f;if(L=b[0],w=b[b.length-1],A=[],q=a.length,b.length===q&&L!==w)for($=0,W=b.length;$<W;$++)T=b[$],A.push((T-L)/(w-L));else for(C=U=0,Z=q-1;0<=Z?U<=Z:U>=Z;C=0<=Z?++U:--U)A.push(C/(q-1));return f=[L,w],F},F.mode=function(b){return arguments.length?(S=b,G(),F):S},F.range=function(b,C){return K(b,C),F},F.out=function(b){return y=b,F},F.spread=function(b){return arguments.length?(j=b,F):j},F.correctLightness=function(b){return b==null&&(b=!0),c=b,G(),c?he=function(C){var T,q,W,$,Z,U,oe,X,de;for(T=ve(0,!0).lab()[0],q=ve(1,!0).lab()[0],oe=T>q,W=ve(C,!0).lab()[0],Z=T+(q-T)*C,$=W-Z,X=0,de=1,U=20;Math.abs($)>.01&&U-- >0;)(function(){return oe&&($*=-1),$<0?(X=C,C+=(de-C)*.5):(de=C,C+=(X-C)*.5),W=ve(C,!0).lab()[0],$=W-Z})();return C}:he=function(C){return C},F},F.padding=function(b){return b!=null?(Q(b)==="number"&&(b=[b,b]),O=b,F):O},F.colors=function(b,C){var T,q,W,$,Z,U,oe,X,de;if(arguments.length<2&&(C="hex"),U=[],arguments.length===0)U=a.slice(0);else if(b===1)U=[F(.5)];else if(b>1)q=f[0],T=f[1]-q,U=function(){oe=[];for(var _e=0;0<=b?_e<b:_e>b;0<=b?_e++:_e--)oe.push(_e);return oe}.apply(this).map(function(_e){return F(q+_e/(b-1)*T)});else{if(e=[],X=[],n&&n.length>2)for(W=de=1,Z=n.length;1<=Z?de<Z:de>Z;W=1<=Z?++de:--de)X.push((n[W-1]+n[W])*.5);else X=f;U=X.map(function(_e){return F(_e)})}return m[C]&&(U=U.map(function(_e){return _e[C]()})),U},F.cache=function(b){return b!=null?(V=b,F):V},F.gamma=function(b){return b!=null?(g=b,F):g},F.nodata=function(b){return b!=null?(M=m(b),F):M},F},m.scales==null&&(m.scales={}),m.scales.cool=function(){return m.scale([m.hsl(180,1,.9),m.hsl(250,.7,.4)])},m.scales.hot=function(){return m.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},m.analyze=function(e,r,n){var s,a,c,f,h,g,w;if(h={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},n==null&&(n=function(){return!0}),s=function(L){L!=null&&!isNaN(L)&&(h.values.push(L),h.sum+=L,L<h.min&&(h.min=L),L>h.max&&(h.max=L),h.count+=1)},w=function(L,S){if(n(L,S))return r!=null&&Q(r)==="function"?s(r(L)):r!=null&&Q(r)==="string"||Q(r)==="number"?s(L[r]):s(L)},Q(e)==="array")for(f=0,c=e.length;f<c;f++)g=e[f],w(g);else for(a in e)g=e[a],w(g,a);return h.domain=[h.min,h.max],h.limits=function(L,S){return m.limits(h,L,S)},h},m.limits=function(e,r,n){var s,a,c,f,h,g,w,L,S,M,y,O,A,j,V,ie,F,ke,ve,G,K,he,b,C,T,q,W,$,Z,U,oe,X,de,_e,Ze,Qe,et,tt,rt,nt,pr,it,st,ot,at,lt,ct,ft,dt,ut,$r,Re,Lt,gr,Ne,ht;if(r==null&&(r="equal"),n==null&&(n=7),Q(e)==="array"&&(e=m.analyze(e)),T=e.min,B=e.max,$r=e.sum,Ne=e.values.sort(function(jt,Pt){return jt-Pt}),n===1)return[T,B];if(b=[],r.substr(0,1)==="c"&&(b.push(T),b.push(B)),r.substr(0,1)==="e"){for(b.push(T),G=oe=1,Ze=n-1;1<=Ze?oe<=Ze:oe>=Ze;G=1<=Ze?++oe:--oe)b.push(T+G/n*(B-T));b.push(B)}else if(r.substr(0,1)==="l"){if(T<=0)throw"Logarithmic scales are only possible for values > 0";for(q=Math.LOG10E*He(T),C=Math.LOG10E*He(B),b.push(T),G=ht=1,Qe=n-1;1<=Qe?ht<=Qe:ht>=Qe;G=1<=Qe?++ht:--ht)b.push(le(10,q+G/n*(C-q)));b.push(B)}else if(r.substr(0,1)==="q"){for(b.push(T),G=s=1,it=n-1;1<=it?s<=it:s>=it;G=1<=it?++s:--s)X=(Ne.length-1)*G/n,de=Oe(X),de===X?b.push(Ne[de]):(_e=X-de,b.push(Ne[de]*(1-_e)+Ne[de+1]*_e));b.push(B)}else if(r.substr(0,1)==="k"){for($=Ne.length,j=new Array($),ke=new Array(n),ut=!0,Z=0,ie=null,ie=[],ie.push(T),G=a=1,st=n-1;1<=st?a<=st:a>=st;G=1<=st?++a:--a)ie.push(T+G/n*(B-T));for(ie.push(B);ut;){for(K=c=0,ot=n-1;0<=ot?c<=ot:c>=ot;K=0<=ot?++c:--c)ke[K]=0;for(G=f=0,at=$-1;0<=at?f<=at:f>=at;G=0<=at?++f:--f){for(gr=Ne[G],W=Number.MAX_VALUE,K=h=0,lt=n-1;0<=lt?h<=lt:h>=lt;K=0<=lt?++h:--h)ve=I(ie[K]-gr),ve<W&&(W=ve,V=K);ke[V]++,j[G]=V}for(U=new Array(n),K=g=0,ct=n-1;0<=ct?g<=ct:g>=ct;K=0<=ct?++g:--g)U[K]=null;for(G=w=0,ft=$-1;0<=ft?w<=ft:w>=ft;G=0<=ft?++w:--w)F=j[G],U[F]===null?U[F]=Ne[G]:U[F]+=Ne[G];for(K=L=0,dt=n-1;0<=dt?L<=dt:L>=dt;K=0<=dt?++L:--L)U[K]*=1/ke[K];for(ut=!1,K=S=0,et=n-1;0<=et?S<=et:S>=et;K=0<=et?++S:--S)if(U[K]!==ie[G]){ut=!0;break}ie=U,Z++,Z>200&&(ut=!1)}for(he={},K=M=0,tt=n-1;0<=tt?M<=tt:M>=tt;K=0<=tt?++M:--M)he[K]=[];for(G=y=0,rt=$-1;0<=rt?y<=rt:y>=rt;G=0<=rt?++y:--y)F=j[G],he[F].push(Ne[G]);for(Re=[],K=O=0,nt=n-1;0<=nt?O<=nt:O>=nt;K=0<=nt?++O:--O)Re.push(he[K][0]),Re.push(he[K][he[K].length-1]);for(Re=Re.sort(function(jt,Pt){return jt-Pt}),b.push(Re[0]),G=A=1,pr=Re.length-1;A<=pr;G=A+=2)Lt=Re[G],!isNaN(Lt)&&b.indexOf(Lt)===-1&&b.push(Lt)}return b},Ye=function(e,r,n){var s,a,c,f;return s=te(arguments),e=s[0],r=s[1],n=s[2],isNaN(e)&&(e=0),e/=360,e<1/3?(a=(1-r)/3,f=(1+r*D(_*e)/D(d-_*e))/3,c=1-(a+f)):e<2/3?(e-=1/3,f=(1-r)/3,c=(1+r*D(_*e)/D(d-_*e))/3,a=1-(f+c)):(e-=2/3,c=(1-r)/3,a=(1+r*D(_*e)/D(d-_*e))/3,f=1-(c+a)),f=ue(n*f*3),c=ue(n*c*3),a=ue(n*a*3),[f*255,c*255,a*255,s.length>3?s[3]:1]},ar=function(){var e,r,n,s,a,c,f,h;return f=te(arguments),c=f[0],r=f[1],e=f[2],_=Math.PI*2,c/=255,r/=255,e/=255,a=Math.min(c,r,e),s=(c+r+e)/3,h=1-a/s,h===0?n=0:(n=(c-r+(c-e))/2,n/=Math.sqrt((c-r)*(c-r)+(c-e)*(r-e)),n=Math.acos(n),e>r&&(n=_-n),n/=_),[n*360,h,s]},m.hsi=function(){return function(e,r,n){n.prototype=e.prototype;var s=new n,a=e.apply(s,r);return Object(a)===a?a:s}(t,xe.call(arguments).concat(["hsi"]),function(){})},x.hsi=Ye,t.prototype.hsi=function(){return ar(this._rgb)},Pe=function(e,r,n,s){var a,c,f,h,g,w,L,S,M,y,O,A,j;return s==="hsl"?(A=e.hsl(),j=r.hsl()):s==="hsv"?(A=e.hsv(),j=r.hsv()):s==="hcg"?(A=e.hcg(),j=r.hcg()):s==="hsi"?(A=e.hsi(),j=r.hsi()):(s==="lch"||s==="hcl")&&(s="hcl",A=e.hcl(),j=r.hcl()),s.substr(0,1)==="h"&&(f=A[0],y=A[1],w=A[2],h=j[0],O=j[1],L=j[2]),!isNaN(f)&&!isNaN(h)?(h>f&&h-f>180?a=h-(f+360):h<f&&f-h>180?a=h+360-f:a=h-f,c=f+n*a):isNaN(f)?isNaN(h)?c=Number.NaN:(c=h,(w===1||w===0)&&s!=="hsv"&&(M=O)):(c=f,(L===1||L===0)&&s!=="hsv"&&(M=y)),M==null&&(M=y+n*(O-y)),g=w+n*(L-w),S=m[s](c,M,g)},z=z.concat(function(){var e,r,n,s;for(n=["hsv","hsl","hsi","hcl","lch","hcg"],s=[],r=0,e=n.length;r<e;r++)Zt=n[r],s.push([Zt,Pe]);return s}()),Se=function(e,r,n,s){var a,c;return a=e.num(),c=r.num(),m.num(a+(c-a)*n,"num")},z.push(["num",Se]),fe=function(e,r,n,s){var a,c,f;return c=e.lab(),f=r.lab(),a=new t(c[0]+n*(f[0]-c[0]),c[1]+n*(f[1]-c[1]),c[2]+n*(f[2]-c[2]),s)},z.push(["lab",fe])}).call(_t)});var Te=new WeakMap,en=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function mr(t,i,o){return i in t?Object.defineProperty(t,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[i]=o,t}function br(t,i,o,l,d){var u={};return Object.keys(l).forEach(function(_){u[_]=l[_]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=o.slice().reverse().reduce(function(_,v){return v(t,i,_)||_},u),d&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(d):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(t,i,u),u=null),u}var zt=0,Xe=0,vr=performance.now(),wr=(t,...i)=>t.map((o,l)=>[o,i[l]]).flat().filter(o=>!!o).join("");function yr(t,i,o){let l=Symbol("private lock"),d=o.value;return o.value=async function(...u){if(this[l]&&(await this[l],this[l]))return void await this[l];let _;this[l]=(()=>{let v,p=new Promise(k=>{v=k});return p.resolve=v,p})();try{_=await d.call(this,...u)}finally{let v=this[l];this[l]=void 0,v.resolve()}return _},o.value.flush=function(){return this[l]},o}var Mt;function Dt(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(Dt.prototype,HTMLElement.prototype),Object.setPrototypeOf(Dt,HTMLElement);var tn=(br((Mt=class extends Dt{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=wr` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;let[,t,i]=this.shadowRoot.children;this._table_clip=i,this._virtual_panel=t,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode!=="both"&&this._virtual_mode!=="vertical"||(this._table_clip.style.top="0px"),this._virtual_mode!=="both"&&this._virtual_mode!=="horizontal"||(this._table_clip.style.left="0px"))}_calculate_viewport(t,i,o,l){let{start_row:d,end_row:u}=this._calculate_row_range(t,o),{start_col:_,end_col:v}=this._calculate_column_range(i,l);return this._nrows=t,{start_col:_,end_col:v,start_row:d,end_row:u}}_calculate_row_range(t,i){let{height:o}=this._container_size,l=this._column_sizes.row_height||19,d=this._view_cache.config.column_pivots.length+1,u=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),_=Math.max(this.scrollTop,0)/u,v=o/l,p=i?t:this._nrows||0,k=Math.max(0,p+(d-v)),x=Math.ceil(k*_);return{start_row:x,end_row:Math.min(Math.ceil(x+v),t)}}_calculate_column_range(t,i){let o=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),l=this.scrollLeft/o,d=this._max_scroll_column(t)+.5;if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let u=Math.floor(d*l);return{start_col:u,end_col:u+(!i&&this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(t){let i=0;if(this._view_cache.config.row_pivots.length>0)for(let l of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))i+=l;let o=t;for(;i<this._container_size.width&&o>=0;)o--,i+=this._column_sizes.indices[o]||60;return Math.min(t-1,o+1)}_validate_viewport({start_col:t,end_col:i,start_row:o,end_row:l}){let d=this._start_col!==t,u=this._start_row!==o||this._end_row!==l||this._end_col!==i;return this._start_col=t,this._end_col=i,this._start_row=o,this._end_row=l,{invalid_column:d,invalid_row:u}}_update_virtual_panel_width(t,i){if(t)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((o,l)=>o+l,0)+"px";else{let o=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),l=this.scrollLeft/o,d=this._max_scroll_column(i),u=0,_=0;for(;u<d;)_+=this._column_sizes.indices[u]||60,u++;let v=this._container_size.width+_;this._virtual_panel.style.width=v+"px",this.scrollLeft=l*_}}_update_virtual_panel_height(t){let{row_height:i=19}=this._column_sizes,o=this.table_model.header.num_rows()*i,l;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")l=t*i+o;else{let d=this.clientHeight/(this._table_clip.offsetHeight-o);l=Math.min(en,t*i*d)}this._virtual_panel.style.height=l+"px"}async draw(t={}){let i=performance.now(),{invalid_viewport:o=!0,preserve_width:l=!1,reset_scroll_position:d=!1,invalid_columns:u=!1}=t;d&&this.reset_scroll(),this._invalid_schema=u||this._invalid_schema;let{num_columns:_,num_rows:v}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight};let p=this._calculate_viewport(v,_,d,u),{invalid_row:k,invalid_column:x}=this._validate_viewport(p);if(this._update_virtual_panel_height(v),this._invalid_schema||k||x||o||x){this.dispatchEvent(new CustomEvent("regular-table-before-update",{bubbles:!0,detail:this}));let I=[];for await(I of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,l,p,_)){this._is_styling=!0;let P=this._style_callbacks;for(let Y of P)await Y({detail:this});if(this._is_styling=!1,!this._invalidated&&I!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(I),this.table_model.header.reset_header_cache(),l||this._update_virtual_panel_width(this._invalid_schema||x||o,_),this._invalid_schema=!1}var z;z=performance.now()-i,zt=(zt*Xe+z)/(Xe+1),Xe+=1}}).prototype,"draw",[yr],Object.getOwnPropertyDescriptor(Mt.prototype,"draw"),Mt.prototype),Mt),Et,rn=(br((Et=class extends tn{register_listeners(){this.addEventListener("mousedown",this._on_click.bind(this)),this.addEventListener("dblclick",this._on_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!1}),this._register_glitch_scroll_listeners()}async _on_scroll(t){t.stopPropagation(),t.returnValue=!1,await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!1}),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!1}),this.addEventListener("touchmove",this._on_touchmove.bind(this),{passive:!1})}_on_mousewheel(t){if(!window.safari)return;let{clientWidth:i,clientHeight:o,scrollTop:l,scrollLeft:d,scrollHeight:u}=this;if(t.deltaY>0&&l+o>=u||t.deltaY<0&&l<=0){t.preventDefault(),t.returnValue=!1;let _=Math.max(1,this._virtual_panel.offsetHeight-o),v=Math.max(1,this._virtual_panel.offsetWidth-i);this.scrollTop=Math.min(_,l+t.deltaY),this.scrollLeft=Math.min(v,d+t.deltaX),this._on_scroll(t)}}_on_touchmove(t){t.preventDefault(),t.returnValue=!1;let{clientWidth:i,clientHeight:o,scrollTop:l,scrollLeft:d}=this,u=Math.max(1,this._virtual_panel.offsetHeight-o),_=Math.max(1,this._virtual_panel.offsetWidth-i);this.scrollTop=Math.min(u,l+(this._memo_touch_startY-t.touches[0].screenY)),this.scrollLeft=Math.min(_,d+(this._memo_touch_startX-t.touches[0].screenX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].screenY,this._memo_touch_startX=t.touches[0].screenX}async _on_dblclick(t){let i=t.target;for(;i.tagName!=="TD"&&i.tagName!=="TH";)if(i=i.parentElement,!this.contains(i))return;let o=t.target.classList.contains("rt-column-resize"),l=Te.get(i);if(o){t.stopImmediatePropagation(),i.style.minWidth="",i.style.maxWidth="",t.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(delete this._column_sizes.override[l.size_key],delete this._column_sizes.auto[l.size_key],delete this._column_sizes.indices[l.size_key]);for(let d of t.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let u of t.shiftKey?d:[d[l._virtual_x]])u&&(u.style.minWidth="",u.style.maxWidth="",u.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(t){if(t.button!==0)return;let i=t.target;for(;i.tagName!=="TD"&&i.tagName!=="TH";)if(i=i.parentElement,!this.contains(i))return;let o=t.target.classList.contains("rt-column-resize"),l=Te.get(i);o&&(this._on_resize_column(t,i,l),t.stopImmediatePropagation())}_on_resize_column(t,i,o){let{_virtual_x:l,size_key:d}=o,u=t.pageX,_=l+i.colSpan-1,v=this.table_model.header.get_column_header(_),p=this._column_sizes.indices[d],k=z=>this._on_resize_column_move(z,v,u,p,d,_),x=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",x);let z=this._column_sizes.override[d],I=this._column_sizes.indices[d]!==z;this._column_sizes.indices[d]=z,I&&this.draw()};document.addEventListener("mousemove",k),document.addEventListener("mouseup",x)}async _on_resize_column_move(t,i,o,l,d,u){await new Promise(setTimeout);let _=t.pageX-o,v=Math.max(1,l+_);if(this._column_sizes.override[d]=v,_<0)await this.draw({preserve_width:!0});else{i.style.minWidth=v+"px",i.style.maxWidth=v+"px";let p=this._column_sizes.auto[d];for(let k of this.table_model.body.cells){let x=k[u];x&&(x.style.maxWidth=x.style.minWidth=v+"px",x.classList.toggle("rt-cell-clip",p>v))}}}}).prototype,"_on_resize_column_move",[yr],Object.getOwnPropertyDescriptor(Et.prototype,"_on_resize_column_move"),Et.prototype),Et),xr=class{constructor(i){this._name=i,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let i=this._elements[this._index];return this._index+=1,i}},Ht=class{constructor(i,o,l){this._column_sizes=i,this._container=o,this._span_factory=new xr("span"),this.table=l,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(i,o){Te.set(i,o)}_get_or_create_metadata(i){if(i===void 0)return{};if(Te.has(i))return Te.get(i);{let o={};return Te.set(i,o),o}}_replace_cell(i,o){let{tr:l,row_container:d}=this._get_row(i),u=d[o];return u&&(l.removeChild(u),d.splice(o,1,void 0)),u}_fetch_cell(i,o){if(i<0||o<0)return;let{row_container:l}=this._get_row(i);return l[o]}_get_cell(i="TD",o,l){let{tr:d,row_container:u}=this._get_row(o),_=u[l];if(_||(l<u.length?(_=u[l]=document.createElement(i),d.insertBefore(_,u.slice(l+1).find(v=>v))):(_=u[l]=document.createElement(i),d.appendChild(_))),_.tagName!==i){let v=document.createElement(i);d.replaceChild(v,_),this.cells[o].splice(l,1,v),_=v}return _}_get_row(i){let o=this.rows[i];o||(o=this.rows[i]=document.createElement("tr"),this.table.appendChild(o));let l=this.cells[i];return l||(l=this.cells[i]=[]),{tr:o,row_container:l}}_clean_columns(i){for(let o=0;o<this.rows.length;o++){let l=this.rows[o],d=this.cells[o];this.cells[o]=d.slice(0,i[o]||i);let u=this.cells[o].filter(_=>_!==void 0).length;for(;l.children[u];)l.removeChild(l.children[u])}}_clean_rows(i){for(;this.table.children[i];)this.table.removeChild(this.table.children[i]);this.rows=this.rows.slice(0,i),this.cells=this.cells.slice(0,i)}},kr=class extends Ht{constructor(...i){super(...i),mr(this,"_group_header_cache",[]),mr(this,"_offset_cache",[])}_draw_group_th(i,o,l){let d=this._get_cell("TH",o,i[o]||0);if(i[o]+=1,d.removeAttribute("colspan"),d.style.minWidth="0",d.textContent="",l instanceof HTMLElement)d.appendChild(l);else{let _=this._span_factory.get("span");_.textContent=l,d.appendChild(_)}let u=this._span_factory.get("span");return u.className="rt-column-resize",d.appendChild(u),d}_draw_group(i,o,l){let d=this._get_or_create_metadata(l);return d.column_header=i,d.value=o,d.value=o,d}_draw_th(i,o,l,d,u){let _=this._get_or_create_metadata(l);if(_.column_header=i,_.value=o,_.size_key=u.length?u[0]:u,!(u.length>1)){let v=this._column_sizes.override[_.size_key],p=this._column_sizes.auto[_.size_key];v?(l.classList.toggle("rt-cell-clip",p>v),l.style.minWidth=v+"px",l.style.maxWidth=v+"px"):p?(l.classList.remove("rt-cell-clip"),l.style.maxWidth="",l.style.minWidth=p+"px"):(l.style.maxWidth="",l.style.maxWidth="")}return _}get_column_header(i){return this._get_cell("TH",this.num_rows()-1,i)}draw(i,o,l,d,u,_,v){let p=o==null?void 0:o.length;if(p===0)return{};let k,x,z;for(let E=0;E<p;E++){if(z=o[E]?o[E]:"",this._offset_cache[E]=this._offset_cache[E]||0,E<p-1){var I,P,Y;((I=this._group_header_cache)===null||I===void 0||(P=I[E])===null||P===void 0||(Y=P[0])===null||Y===void 0?void 0:Y.value)===z?(k=this._group_header_cache[E][1],this._group_header_cache[E][2]+=1,l===1&&(this._group_header_cache[E][0].row_header_x=u),k.setAttribute("colspan",this._group_header_cache[E][2])):(k=this._draw_group_th(this._offset_cache,E,z),x=this._draw_group(o,z,k),this._group_header_cache[E]=[x,k,1])}else{k=this._draw_group_th(this._offset_cache,E,z),x=this._draw_th(i||o,z,k,d,u);for(let[N]of this._group_header_cache)N.size_key=x.size_key;k.removeAttribute("colspan")}x&&(x.x=d,x.column_header_y=E,x.x0=_,x._virtual_x=v,l===1&&(x.row_header_x=u))}return this._clean_rows(this._offset_cache.length),{th:k,metadata:x}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Lr=class extends Ht{_draw_td(i,o,l,d,{column_name:u},{ridx_offset:_},v){let p=this._get_cell(i,o,d),k=this._get_or_create_metadata(p);k.y=o+_,k.size_key=v,i==="TD"&&(k.column_header=u);let x=this._column_sizes.override[k.size_key];if(x){let z=this._column_sizes.auto[k.size_key];p.classList.toggle("rt-cell-clip",z>x),p.style.minWidth=x+"px",p.style.maxWidth=x+"px"}else p.classList.remove("rt-cell-clip"),p.style.minWidth="",p.style.maxWidth="";return l instanceof HTMLElement?(p.textContent="",p.appendChild(l)):p.textContent=l,k.value=l,{td:p,metadata:k}}draw(i,o,l,d=!1,u,_,v){let{cidx:p,column_data:k,row_headers:x,column_data_listener_metadata:z}=o,I,{row_height:P}=l,Y=[],E=[],N=0,R=[];for(let m=0;m<(d?l.row_headers_length:1);m++){N=0;for(let J of k){var ee;let se=x==null?void 0:x[N],H;if(d){let D=J[m],ne=this._fetch_cell(N-(Y[m]||1),p+m),ae=this._get_or_create_metadata(ne),pe=this._fetch_cell(N,p+m-(R[N]||1)),ce=this._get_or_create_metadata(pe);!pe||ce.value!==D&&D!==void 0||pe.hasAttribute("rowspan")?ne&&ae.value===D&&!ne.hasAttribute("colspan")?(Y[m]=Y[m]?Y[m]+1:2,ne.setAttribute("rowspan",Y[m]),this._replace_cell(N,p+m)):(H=this._draw_td("TH",N,D,p+m,o,l,m),H.td.style.display="",H.td.removeAttribute("rowspan"),H.td.removeAttribute("colspan"),H.metadata.row_header=J,H.metadata.row_header_x=m,H.metadata.x0=_,H.metadata.y0=l.ridx_offset,H.metadata.y1=l.y1,H.metadata._virtual_x=m,Y[m]=1,R[N]=1,E[m]=H):(R[N]=R[N]?R[N]+1:2,pe.setAttribute("colspan",R[N]),this._replace_cell(N,p+m))}else H=this._draw_td("TD",N,J,p,o,l,v),z&&(H.metadata.user=z[N]),H.metadata.x=u,H.metadata.x0=_,H.metadata.x1=l.x1,H.metadata.row_header=se||[],H.metadata.y0=l.ridx_offset,H.metadata.y1=l.y1,H.metadata.dx=u-_,H.metadata.dy=H.metadata.y-H.metadata.y0,H.metadata._virtual_x=p,E[0]=H;if(N++,I=H?H.metadata:I,P=P||((ee=H)===null||ee===void 0?void 0:ee.td.offsetHeight),N*P>i)break}}return this._clean_rows(N),{tds:E,ridx:N,metadata:I,row_height:P}}clean({ridx:i,cidx:o}){this._clean_rows(i),this._clean_columns(o)}},Tt=class{constructor(i,o,l){this.clear(l);let[d]=l.children,[u,_]=d.children;this.table=d,this._column_sizes=o,this.header=new kr(o,i,u),this.body=new Lr(o,i,_),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(i){i.innerHTML=wr` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(i){for(;i.length>0;){let[o,l,d]=i.pop(),u,_=getComputedStyle(o);_.boxSizing!=="border-box"?(u=o.clientWidth,u-=parseFloat(_.paddingLeft),u-=parseFloat(_.paddingRight)):u=parseFloat(window.getComputedStyle(o).width),this._column_sizes.row_height=this._column_sizes.row_height||d.offsetHeight,this._column_sizes.indices[l.size_key]=u;let v=this._column_sizes.override.hasOwnProperty(l.size_key);u&&!v&&(this._column_sizes.auto[l.size_key]=u),o.style.minWidth==="0px"&&(o.style.minWidth=u+"px")}}async*draw(i,o,l,d,u,_){var v,p,k,x;let{width:z,height:I}=i,{view:P,config:Y}=o,{data:E,row_headers:N,column_headers:R,metadata:ee}=await P(u.start_col,u.start_row,u.end_col,u.end_row),{start_row:m=0,start_col:J=0,end_col:se=0,end_row:H=0}=u;N&&(this._row_headers_length=N.reduce((re,je)=>Math.max(re,je.length),0),N=N.map(re=>(re.length=this._row_headers_length,re))),o.config.column_pivots=Array.from(Array((R==null||(v=R[0])===null||v===void 0?void 0:v.length)-1||0).keys()),o.config.row_pivots=Array.from(Array(((p=N)===null||p===void 0||(k=p[0])===null||k===void 0?void 0:k.length)||0).keys());let D={viewport_width:0,selected_id:l,ridx_offset:m,x0:J,x1:se,y1:H,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},ne,ae=0,pe=[],ce=!0;if(((x=N)===null||x===void 0?void 0:x.length)>0){let re=Y.row_pivots.join(","),je={column_name:re,cidx:0,column_data:N,row_headers:N,first_col:ce},Ae=ae+J;ne=this.body.draw(I,je,{...D,x0:0},!0,void 0,void 0,Ae);let Pe=[];for(let fe=0;fe<o.config.row_pivots.length;fe++)Pe.push(this.header.draw(re,Array(o.config.column_pivots.length+1).fill(""),1,void 0,fe,J,fe));if(ce=!1,D.viewport_width+=Pe.reduce((fe,{th:Le},Se)=>fe+(this._column_sizes.indices[Se]||Le.offsetWidth),0),D.row_height=D.row_height||ne.row_height,ae=N[0].length,!d)for(let fe=0;fe<o.config.row_pivots.length;fe++){let{td:Le,metadata:Se}=ne.tds[fe]||{},{th:ze,metadata:De}=Pe[fe];pe.push([ze||Le,De||Se,Le||ze])}}try{var Oe;let re=0,je=_-u.start_col;for(;re<je;){if(!E[re]){let ge=Math.max(u.end_col,0);u.start_col=ge;let me=0,Me=0;for(;this._column_sizes.indices.length>ae+J+me+1&&Me+D.viewport_width<z;)me++,Me+=this._column_sizes.indices[ae+J+me];if(Me+D.viewport_width<z){let ue=Math.min(_,ge+5);u.end_col=Math.max(1,Math.min(_,ue))}else u.end_col=Math.max(1,Math.min(_,ge+me));let Ue=P(u.start_col,u.start_row,u.end_col,u.end_row);yield;let Ee=await Ue;if(Ee.data.length===0)return void(yield pe);u.end_col=u.start_col+Ee.data.length;for(let ue=0;ue<Ee.data.length;ue++){var Be;E[re+ue]=Ee.data[ue],Ee.metadata&&(ee[re+ue]=Ee.metadata[ue]),R&&(R[re+ue]=(Be=Ee.column_headers)===null||Be===void 0?void 0:Be[ue])}}let Ae=(R==null?void 0:R[re])||"",Pe=E[re],fe={column_name:Ae,cidx:ae,column_data:Pe,column_data_listener_metadata:ee==null?void 0:ee[re],row_headers:N,first_col:ce},Le=re+J,Se=ae+J,ze=this.header.draw(void 0,Ae,void 0,Le,Se,J,ae);if(ne=this.body.draw(I,fe,D,!1,Le,J,Se),ce=!1,!d)for(let{td:ge,metadata:me}of ne.tds)pe.push([ze.th||ge,ze.metadata||me,ge||ze.th]);let De=this._column_sizes.indices[ae+J];var Ce;if(De?D.viewport_width+=De:D.viewport_width+=((Ce=ze.th)===null||Ce===void 0?void 0:Ce.offsetWidth)||ne.tds.reduce((ge,me)=>{var Me;return ge+((Me=me.td)===null||Me===void 0?void 0:Me.offsetWidth)},0),D.row_height=D.row_height||ne.row_height,ae++,re++,D.viewport_width>z){var Ye;this.body.clean({ridx:((Ye=ne)===null||Ye===void 0?void 0:Ye.ridx)||0,cidx:ae}),this.header.clean(),yield pe,D.viewport_width=0;for(let[ge]of pe)D.viewport_width+=ge.offsetWidth;if(D.viewport_width>z)return}}this.body.clean({ridx:((Oe=ne)===null||Oe===void 0?void 0:Oe.ridx)||0,cidx:ae}),this.header.clean(),yield pe}finally{var $e;this.body.clean({ridx:(($e=ne)===null||$e===void 0?void 0:$e.ridx)||0,cidx:ae}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},nn=["both","horizontal","vertical","none"],zr=class extends rn{constructor(){super(),this._column_sizes={auto:{},override:{},indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new Tt(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto={},this._column_sizes.override={},this._column_sizes.indices=[];for(let i=0;i<this.table_model.header.num_columns();i++){let o=this.table_model.header.get_column_header(i);o.style.minWidth="",o.style.maxWidth=""}}clear(){this.table_model=new Tt(this._table_clip,this._column_sizes,this)}addStyleListener(i){this._style_callbacks=this._style_callbacks.concat(i);let o=!0;return()=>{if(!o)return;o=!1;let l=this._style_callbacks=this._style_callbacks.slice(),d=l.indexOf(i);l.splice(d,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(i){if(i!==void 0){if(i instanceof HTMLElement)return Te.get(i);if(i.row_header_x>=0){if(i.row_header_x<this._view_cache.config.row_pivots.length){let o=this.table_model.body._fetch_cell(i.y,i.row_header_x);return this.getMeta(o)}}else{if(!(i.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(i.dy,i.dx+this.table_model._row_headers_length));if(i.column_header_y<this._view_cache.config.column_pivots.length){let o=this.table_model.body._fetch_cell(i.column_header_y,i.y);return this.getMeta(o)}}}}getDrawFPS(){return function(){let i=performance.now(),o=i-vr,l=zt,d=1e3*Xe/o,u=Xe;return zt=0,Xe=0,vr=i,{avg:l,real_fps:d,virtual_fps:1e3/l,num_frames:u,elapsed:o}}()}async scrollToCell(i,o,l,d){let u=this._virtual_panel.offsetHeight/d;this.scrollTop=u*o,this.scrollLeft=i/(this._max_scroll_column(l)||l)*(this.scrollWidth-this.clientWidth),await this.draw.flush()}setDataListener(i,{virtual_mode:o="both"}={}){console.assert(nn.indexOf(o)>-1,`Unknown virtual_mode ${o};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=o,this._invalid_schema=!0,this._view_cache={view:i,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",zr);var Ar=Wt(Or());var gt=Wt(qt()),ye=Symbol("Plugin Symbol"),We;function Ot(t){let[i,o,l]=t.rgb(),[d,u,_]=t.set("hsl.h",(t.get("hsl.h")-15)%360).rgb(),[v,p,k]=t.set("hsl.h",(t.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${d},${u},${_}),rgb(${i},${o},${l}) 50%,rgb(${v},${p},${k}))`}function Cr(t,i,o){We=We||document.createElement("perspective-column-style");let l=t.getMeta(i),d=l.column_header[l.column_header.length-1],u=this._schema[d],_={gradient:o,pos_color:this._pos_color[0],neg_color:this._neg_color[0],color_mode:"foreground"};if(u==="float")_.fixed=2;else if(u==="integer")_.fixed=0;else{this._open_column_styles_menu.pop(),t.draw();return}let v=()=>We.blur(),p=I=>{let P=I.detail;P.pos_color&&(P.pos_color=[P.pos_color,...(0,gt.default)(P.pos_color).rgb(),Ot((0,gt.default)(P.pos_color))],P.neg_color=[P.neg_color,...(0,gt.default)(P.neg_color).rgb(),Ot((0,gt.default)(P.neg_color))]),t[ye]=t[ye]||{},t[ye][d]=P,t.draw({preserve_width:!0}),t.parentElement.dispatchEvent(new Event("perspective-config-update"))},k=async()=>{t.removeEventListener("regular-table-scroll",v),We.removeEventListener("perspective-column-style-change",p),We.removeEventListener("blur",k),this._open_column_styles_menu.pop(),await t.draw(),t.parentElement.dispatchEvent(new Event("perspective-config-update"))};We.addEventListener("perspective-column-style-change",p),We.addEventListener("blur",k),t.addEventListener("regular-table-scroll",v);let x=t[ye]||{},z=Object.assign({},x[d]=x[d]||{});z.pos_color&&(z.pos_color=z.pos_color[0],z.neg_color=z.neg_color[0]),We.open(i,z,_)}function Bt([t,i,o,l],d=[255,255,255]){function u(_,v){return((1-l)*(d[_]/255)+l*(v/255))*255}return[u(0,t),u(1,i),u(2,o)]}function Yt([t,i,o]){return Math.sqrt(t*t*.299+i*i*.587+o*o*.114)>130?"#161616":"#ffffff"}var $t=Wt(qt());function sn(t){let i=t._view_cache.config.row_pivots.length-1,o=Array.from(t.children[0].children[0].children),l=t[ye]||{};if(o.length>0){let[v]=o.splice(o.length-1,1);for(let p of v?.children){let k=t.getMeta(p),x=k.column_header?.[k.column_header?.length-1],z=this._config.sort.find(N=>N[0]===x),I=k.row_header_x===i,P=typeof k.x=="undefined";I=I||(k.x+1)%this._config.columns.length==0,p.classList.toggle("psp-header-border",I),p.classList.toggle("psp-header-group",!1),p.classList.toggle("psp-header-leaf",!0),p.classList.toggle("psp-is-top",!1),p.classList.toggle("psp-header-corner",P),p.classList.toggle("psp-header-sort-asc",!!z&&z[1]==="asc"),p.classList.toggle("psp-header-sort-desc",!!z&&z[1]==="desc"),p.classList.toggle("psp-header-sort-col-asc",!!z&&z[1]==="col asc"),p.classList.toggle("psp-header-sort-col-desc",!!z&&z[1]==="col desc");let Y=Ut.call(this,k),E=Y==="integer"||Y==="float";p.classList.toggle("psp-align-right",E),p.classList.toggle("psp-align-left",!E),p.classList.toggle("psp-menu-open",this._open_column_styles_menu[0]===k._virtual_x),p.classList.toggle("psp-menu-enabled",E&&!P),p.classList.toggle("psp-is-width-override",t._column_sizes?.override[k.size_key]!==void 0)}}let d=[],u=new Set,_=t.children[0];for(let v=0;v<o.length;v++){let p=_.rows[v],k=new Set;for(let x=0;x<p.cells.length;x++){let z=p.cells[x];z.style.backgroundColor="";let I=t.getMeta(z),P=I.row_header_x===i||I.x>=0;z.classList.toggle("psp-align-right",!1),z.classList.toggle("psp-align-left",!1),z.classList.toggle("psp-header-group",!0),z.classList.toggle("psp-header-leaf",!1),z.classList.toggle("psp-header-border",P),z.classList.toggle("psp-header-group-corner",typeof I.x=="undefined"),z.classList.toggle("psp-color-mode-bar",!1),z.classList.toggle("psp-header-sort-asc",!1),z.classList.toggle("psp-header-sort-desc",!1),z.classList.toggle("psp-header-sort-col-asc",!1),z.classList.toggle("psp-header-sort-col-desc",!1);let Y=p.cells[x],E=x,N,R;for(;d[v]&&d[v][E];++E);for(k.add(E),N=E;N<E+Y.colSpan;++N)for(R=v;R<v+Y.rowSpan;++R)d[R]||(d[R]=[]),d[R][N]=!0;Y.classList.toggle("psp-is-top",v===0||!u.has(N))}u=k}for(let v of t.children[0].children[1].children)for(let p of v.children){let k=t.getMeta(p),x=k.column_header?.[k.column_header?.length-1],z=l[x],I=Ut.call(this,k),P=I==="integer"||I==="float";if(P){let E=k.user>0,N=k.user<0,[R,ee,m,J,se]=(()=>z?.pos_color!==void 0?E?z.pos_color:N?z.neg_color:["",0,0,0,""]:E?this._pos_color:N?this._neg_color:["",0,0,0,""])();if(p.style.position="",z?.color_mode==="background"){let H=this._plugin_background,D=Yt(Bt([ee,m,J,1],H));p.style.color=D,p.style.backgroundColor=R}else if(z?.color_mode==="gradient"){let H=Math.max(0,Math.min(1,Math.abs(k.user/z.gradient))),D=this._plugin_background,ne=Yt(Bt([ee,m,J,H],D));p.style.color=ne,p.style.backgroundColor=`rgba(${ee},${m},${J},${H})`}else z?.color_mode==="disabled"?(p.style.backgroundColor="",p.style.color=""):z?.color_mode==="bar"?(p.style.backgroundColor="",p.style.color="",p.style.position="relative",se!==""&&p.children.length>0&&p.children[0].nodeType===Node.ELEMENT_NODE&&(p.children[0].style.background=se)):(p.style.backgroundColor="",p.style.color=R)}else if(I==="boolean"){let[E]=k.user===!0?this._pos_color:k.user===!1?this._neg_color:["",0,0,0,""];p.style.backgroundColor="",p.style.color=E}else p.style.backgroundColor="",p.style.color="";p.classList.toggle("psp-bool-type",I==="boolean"&&k.user!==null);let Y=p.tagName==="TH";if(Y){let E=typeof k.value!=null&&typeof k.value!=null&&k.value?.toString()?.trim().length>0,N=k.row_header_x>=this._config.row_pivots.length,R=t.getMeta({dx:0,dy:k.y-k.y0+1}),ee=R&&R.row_header&&typeof R.row_header[k.row_header_x+1]!="undefined";p.classList.toggle("psp-tree-label",E&&!N),p.classList.toggle("psp-tree-label-expand",E&&!N&&!ee),p.classList.toggle("psp-tree-label-collapse",E&&!N&&ee),p.classList.toggle("psp-tree-leaf",E&&N)}p.classList.toggle("psp-align-right",!Y&&P),p.classList.toggle("psp-align-left",Y||!P),p.classList.toggle("psp-color-mode-bar",z?.color_mode==="bar")}}async function on(t,i,o){let l=t.getMeta(o),d=l.column_header[l.column_header.length-1],_=(i.shiftKey?an:ln).call(this,d);t.dispatchEvent(new CustomEvent("regular-table-psp-sort",{detail:{sort:_}}))}function an(t){let i=[],o=!1;for(let l of this._config.sort){let[d,u]=l;if(d===t){o=!0;let _=Sr.call(this,t,u);_&&i.push(_)}else i.push(l)}return o||i.push([t,"desc"]),i}function ln(t){for(let[i,o]of this._config.sort)if(i===t){let l=Sr.call(this,t,o);return l?[l]:[]}return[[t,"desc"]]}function Sr(t,i){let l=this._config.column_pivots.length>0?fn:cn,d=i?l[i]:"desc";if(d)return[t,d]}var cn={desc:"asc",asc:void 0},fn={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function dn(t,i){let o=t.getMeta(i.target),l=i.target.classList.contains("psp-tree-label-collapse");i.shiftKey&&l?this._view.set_depth(o.row_header.filter(d=>d!==void 0).length-2):i.shiftKey?this._view.set_depth(o.row_header.filter(d=>d!==void 0).length-1):l?this._view.collapse(o.y):this._view.expand(o.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),t.draw()}async function un(t,i){if(i.which!==1)return;let o=i.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!t.contains(o))return;if(o.classList.contains("psp-tree-label")&&i.offsetX<26){dn.call(this,t,i),i.stopImmediatePropagation();return}let l=o.getBoundingClientRect();if(o.classList.contains("psp-menu-enabled")&&i.clientY-l.top>16){let d=t.getMeta(o),u=d.column_header?.[d.column_header?.length-1],[,_]=await this._view.get_min_max(u);this._open_column_styles_menu.unshift(d._virtual_x),t.draw(),Cr.call(this,t,o,_),i.preventDefault(),i.stopImmediatePropagation()}else o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner")&&(on.call(this,t,i,o),i.stopImmediatePropagation())}function hn(t,i){if(i.which!==1)return;let o=i.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!t.contains(o))return;(o.classList.contains("psp-tree-label")&&i.offsetX<26||o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner"))&&i.stopImmediatePropagation()}var Ge={},Xt={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(t){return t?"check":"close"}}},Fr=Ge;function jr(t,i,o={},l=!1){if(i===null)return"-";let d=t[t.length-1],u=o[d],_=l&&this._table_schema[d]||this._schema[d]||"string",v=_==="integer"||_==="float";if(v&&u?.color_mode==="bar"){let p=Math.max(0,Math.min(.95,Math.abs(i/u.gradient)*.95)),k=this._div_factory.get(),x=i>=0?"left":"right";return k.setAttribute("style",`width:${(p*100).toFixed(2)}%;position:absolute;${x}:0;height:80%;top:10%;pointer-events:none;`),k}else{let p=v&&u&&u.fixed!==void 0,k=p?`${_}${u.fixed}`:_;if(Ge[k]===void 0){let x=(0,Ar.get_type_config)(_);if(p){let z={minimumFractionDigits:u.fixed,maximumFractionDigits:u.fixed};Ge[k]=new Xt[_]("en-us",z)}else Xt[_]?Ge[k]=new Xt[_]("en-us",x.format):Ge[k]=!1}return Ge[k]?Ge[k].format(i):i}}function*_n(t=[],i,o){let l=o[ye];for(let d of t){d=["TOTAL",...d];let u=d[d.length-1];d=d.slice(0,d.length-1).fill("");let _=jr.call(this,[i[d.length-1]],u,l,!0);d=d.concat({toString:()=>_}),d.length=i.length+1,yield d}}async function pn(t,i,o,l,d){let u={};l-i>0&&d-o>0?(u=await this._view.to_columns({start_row:o,start_col:i,end_row:d,end_col:l,id:!0}),this._ids=u.__ID__):this._div_factory.clear();let _=[],v=[],p=[];for(let k of this._column_paths.slice(i,l)){let x=k.split("|"),z=u[k]||new Array(d-o).fill(null);_.push(z.map(I=>jr.call(this,x,I,t[ye]))),v.push(z),p.push(x)}return{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(_n.call(this,u.__ROW_PATH__,this._config.row_pivots,t)),column_headers:p,data:_,metadata:v}}function Vt(t,i,o){let l=window.getComputedStyle(t).getPropertyValue(i).trim();return l.length>0?l:o}var Pr=class{constructor(i){this._name=i,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let i=this._elements[this._index];return this._index+=1,i}};function mt(t){let i=(0,$t.default)(t),o=Ot(i);return[t,...i.rgb(),o]}async function Kt(t,i,o,l={}){let d=await o.get_config(),u=d.expressions.map(se=>se[1]),[_,v,p,k,x,z]=await Promise.all([i.schema(),i.validate_expressions(u),o.num_rows(),o.schema(),o.expression_schema(),o.column_paths()]),I=(0,$t.default)(Vt(t,"--plugin--background","#FFFFFF")).rgb(),P=mt(Vt(t,"--rt-pos-cell--color","#338DCD")),Y=mt(Vt(t,"--rt-neg-cell--color","#FF5942")),E={...k,...x},N={..._,...v.expression_schema},R=z.filter(se=>se!=="__ROW_PATH__"&&se!=="__ID__"),ee=[],m=[];for(let se of R){let H=se.split("|"),D=H[H.length-1];m.push(E[D]),ee.push(!!_[D])}let J=Object.assign(l,{_view:o,_table:i,_table_schema:N,_config:d,_num_rows:p,_schema:E,_ids:[],_open_column_styles_menu:[],_plugin_background:I,_pos_color:P,_neg_color:Y,_column_paths:R,_column_types:m,_is_editable:ee,_row_header_types:d.row_pivots.map(se=>N[se]),get_psp_type:Ut});return J._div_factory=J._div_factory||new Pr("div"),t.setDataListener(pn.bind(J,t),{virtual_mode:t.parentElement.virtual_mode||"both"}),J}function Ut(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}async function Ir(t,i){t.addStyleListener(sn.bind(i,t)),t.addEventListener("mousedown",un.bind(i,t)),t.addEventListener("click",hn.bind(i,t)),await t.draw()}var Rr=`regular-table{padding:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}regular-table{font-family:"Open Sans"}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0px}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #ddd}regular-table th{position:relative}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:"Material Icons"}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:"Material Icons"}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px #1a7da1}regular-table .rt-selected td{background-color:#eee}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.rt-group-name{text-align:left}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#0000;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:#00000026}regular-table::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0 var(--pv-divider--color, #eaedef)}.psp-header-group{box-shadow:0 10px 0 -9px var(--pv-divider--color, #eaedef)}.psp-is-top{box-shadow:5px 4px 0 -4px var(--pv-divider--color, #eaedef)}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0 -4px var(--pv-divider--color, #eaedef),0 10px 0 -9px var(--pv-divider--color, #eaedef)}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0 var(--pv-divider--color, #eaedef),0 10px 0 -9px var(--pv-divider--color, #eaedef)}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0 -4px var(--pv-divider--color, #eaedef)}tr:only-child th{box-shadow:none!important}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--rt-hover--border-color, #c5c9d080)!important;background-color:transparent;box-shadow:0 1px 0 var(--rt-hover--border-color, #c5c9d080),0 3px #0000000d,0 5px #00000003}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:1px;border-right-color:transparent}regular-table tbody tr:hover{color:#161616}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color, #c5c9d080)!important}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color, #c5c9d080)!important}perspective-viewer[settings] regular-table .psp-header-leaf{height:36px;vertical-align:top;padding-top:2px}perspective-viewer[settings] regular-table .psp-header-leaf:not(.psp-header-corner):before{font-family:"Material Icons";content:"menu";position:absolute;width:calc(100% - 8px);left:5px;bottom:0px;color:var(--inactive--color, #b4b7be)}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:not(.psp-header-corner):before{color:inherit;cursor:pointer}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner){pointer-events:none}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner):before{content:"expand_less"}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:hover:before{color:#338dcd}perspective-viewer[settings] regular-table .psp-header-leaf .rt-column-resize{height:18px}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:#fff!important;background-color:#ea7319!important;border-color:#ea7319!important}.psp-row-selected.psp-tree-label:not(:hover):before{color:#fff}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,.2)!important}.psp-error{color:red}td:focus{outline:#666;outline-style:dotted;outline-width:1px}perspective-viewer.dragging regular-table{pointer-events:none}.psp-header-border:last-child{border-right-width:0px}.psp-header-sort-desc:after{font-family:"Material Icons";font-size:10px;content:"arrow_downward"}.psp-header-sort-asc:after{font-family:"Material Icons";font-size:10px;content:"arrow_upward"}.psp-header-sort-col-desc:after{font-family:"Material Icons";font-size:10px;content:"arrow_back"}.psp-header-sort-col-asc:after{font-family:"Material Icons";font-size:10px;content:"arrow_forward"}tbody th:last-of-type{border-right:1px solid #eaedef;overflow:hidden;text-overflow:ellipsis}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,#eee 10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none}.psp-tree-label{max-width:0px;min-width:0px}.psp-tree-label:before{color:#ccc;font-family:"Material Icons";padding-right:11px;vertical-align:-1px}.psp-tree-label-expand:before{content:"add"}.psp-tree-label-collapse:before{content:"remove"}.psp-tree-label:hover:before{color:#338dcd;text-shadow:0px 0px 5px #338dcd}regular-table thead tr:last-child th{border-bottom-width:0px}.psp-tree-leaf{padding-left:24px}.psp-align-right{text-align:right}.psp-align-left{text-align:left}.psp-positive:not(:focus){color:var(--rt-pos-cell--color, #338dcd)}.psp-negative:not(:focus){color:var(--rt-neg-cell--color, #ff5942)}regular-table table tbody td{min-width:52px!important}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed #999;border-bottom-width:0px;border-left-width:0px}.psp-bool-type{font-family:"Material Icons"}.boolean-editable{cursor:pointer}regular-table table{user-select:none;color:#161616;border-collapse:separate}regular-table table th{font-weight:400}regular-table table td,regular-table table th{border-color:#eaedef;height:23px}regular-table table .psp-header-group{text-overflow:ellipsis}regular-table table .psp-header-leaf{border-bottom-width:0px}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px}regular-table table tbody th:empty{background-position:0px -10px}
`;async function bt({_view:t,_config:i},o,l){let d=i.row_pivots,u=i.column_pivots,_=o>=0?o:0,v=_+1,p=await t.to_json({start_row:_,end_row:v}),x=p.map(R=>R.__ROW_PATH__)[0]||[],z=d.map((R,ee)=>{let m=x[ee];return m?[R,"==",m]:void 0}).filter(R=>R),I=d.length>0?l+1:l,P=Object.keys(p[0])[I],Y={row:p[0]},E=[];if(P){let R=P.split("|");Y.column_names=[R[R.length-1]],E=u.map((ee,m)=>{let J=R[m];return J?[ee,"==",J]:void 0}).filter(ee=>ee).filter(([,,ee])=>ee!=="__ROW_PATH__")}let N=i.filter.concat(z).concat(E);return Y.config={filter:N},Y}var Ve=new WeakMap;async function mn(t,i,o){let l=t.getMeta(o.target);if(!i.hasAttribute("selectable")||o.handled||o.which!==1||!l)return;let d=this._ids[l.y-l.y0];if(l&&l.y>=0){let u=Ve.get(t),_=!!u&&u.reduce((k,x,z)=>k&&x===d[z],!0),v=!!u&&d.length===u.length&&_,p=[];v?Ve.delete(t):(Ve.set(t,d),p=await bt(this,l.y,l.x),p=p.config.filter),await t.draw(),o.handled=!0,i.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:!v,config:{filter:p}}}))}}function bn(t,i){if(!i.hasAttribute("selectable"))return;let o=Ve.has(t),l=Ve.get(t);for(let d of t.querySelectorAll("td"))if(!o)d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let u=t.getMeta(d),_=this._ids[u.y-u.y0],v=l.reduce((p,k,x)=>p&&k===_[x],!0);d.classList.toggle("psp-row-selected",_.length===l.length&&v),d.classList.toggle("psp-row-subselected",_.length!==l.length&&v)}for(let d of t.querySelectorAll("tbody th")){let u=t.getMeta(d),_=this._ids[u.y-u.y0];if(!o||!!_[u.row_header_x])d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let v=l.reduce((p,k,x)=>p&&k===_[x],!0);d.classList.toggle("psp-row-selected",_.length===l.length&&v),d.classList.toggle("psp-row-subselected",_.length!==l.length&&v)}}}function Wr(t,i){t.addStyleListener(bn.bind(this,t,i)),t.addEventListener("mousedown",mn.bind(this,t,i))}async function Dr(t){Ve.delete(t);for(let i of t.querySelectorAll("td,th"))i.classList.toggle("psp-row-selected",!1),i.classList.toggle("psp-row-subselected",!1)}async function vn(t,i,o){let l=t.getMeta(o.target);if(!l)return;let{x:d,y:u}=l,{row:_,column_names:v,config:p}=await bt(this,u,d);i.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:_,column_names:v,config:p}}))}function Hr(t,i){t.addEventListener("click",vn.bind(this,t,i))}var qe=new WeakMap;function wn(t){let i;return async function(...o){if(!!i&&await i&&!!i)return;let l;i=new Promise(d=>l=d),await t.apply(this,o),i=void 0,l()}}function Tr(){if(this.isContentEditable){let t=document.getSelection().getRangeAt(0),i=t.cloneRange();return i.selectNodeContents(this),i.setEnd(t.endContainer,t.endOffset),i.toString().length}else return this.target.selectionStart}function Gr(t,i,o){let l=t.getMeta(o),d=i._schema[i._column_paths[l.x]];if(l){let u=o.textContent,_=i._ids[l.y-l.y0];if(d==="float"||d==="integer"){if(u=parseFloat(u.replace(/,/g,"")),isNaN(u))return!1}else if(d==="date"||d==="datetime"){if(u=Date.parse(u),isNaN(u))return!1}else d==="boolean"&&(u=u==="check"?!1:u==="close"?!0:null);let v={__INDEX__:_,[i._column_paths[l.x]]:u};return i._table.update([v],{port_id:i._edit_port}),!0}}function Jt(t){let i=this._config.row_pivots.length===0&&this._config.column_pivots.length===0,o=t.hasAttribute("selectable"),l=t.hasAttribute("editable");return i&&!o&&l}var Ke=wn(async function(t,i,o,l){let d=t.getMeta(i),u=this._column_paths.length,_=this._num_rows,v=qe.get(t);if(!v)return;d.x+o<u&&0<=d.x+o&&(v.x=d.x+o),d.y+l<_&&0<=d.y+l&&(v.y=d.y+l);let p=Math.max(d.x0-10,0),k=Math.min(d.x0+10,u),x=Math.max(d.y0-5,0),z=Math.min(d.y0+10,_),I=d.x0+o,P=d.y0+l;for(;!qr(t)&&I>=p&&I<k&&P>=x&&P<z;)await t.scrollToCell(I,P,u,_),qe.set(t,v),I+=o,P+=l});function yn(t,i){if(!i.hasAttribute("editable"))return;let o=Jt.call(this,i);for(let l of t.querySelectorAll("td")){let d=t.getMeta(l),u=this.get_psp_type(d);this._is_editable[d.x]?u==="boolean"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",d.user!==null)):(l.toggleAttribute("contenteditable",o),l.classList.toggle("boolean-editable",!1)):(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1))}}var qr=t=>{let i=t.querySelectorAll("td"),o=qe.get(t);if(o){for(let l of i){let d=t.getMeta(l);if(d.x===o.x&&d.y===o.y)return document.activeElement!==l&&l.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&t.contains(document.activeElement)&&document.activeElement.blur()}};function xn(t,i,o){if(!Jt.call(this,i))return;let l=document.activeElement;switch(o.target.classList.remove("psp-error"),o.keyCode){case 13:o.preventDefault(),o.shiftKey?Ke.call(this,t,l,0,-1):Ke.call(this,t,l,0,1);break;case 37:Tr.call(l)==0&&(o.preventDefault(),Ke.call(this,t,l,-1,0));break;case 38:o.preventDefault(),Ke.call(this,t,l,0,-1);break;case 39:Tr.call(l)==l.textContent.length&&(o.preventDefault(),Ke.call(this,t,l,1,0));break;case 40:o.preventDefault(),Ke.call(this,t,l,0,1);break;default:}}function kn(t,i,o){if(Jt.call(this,i)&&qe.has(t)){o.target.classList.remove("psp-error");let l=qe.get(t);qe.delete(t),l.content!==o.target.textContent&&(Gr(t,this,o.target)||(o.target.textContent=l.content,o.target.classList.add("psp-error"),o.target.focus()))}}function Ln(t,i,o){let l=t.getMeta(o.target);if(l){let d={x:l.x,y:l.y,content:o.target.textContent};qe.set(t,d)}}function zn(t,i,o){let l=t.getMeta(o.target);if(typeof l?.x!="undefined"){let d=this._is_editable[l.x],u=this.get_psp_type(l)==="boolean",_=o.target.textContent==="-";d&&u&&!_&&Gr(t,this,o.target)}}async function Br(t,i){this._edit_port=await i.getEditPort(),t.addStyleListener(yn.bind(this,t,i)),t.addStyleListener(qr.bind(this,t,i)),t.addEventListener("click",zn.bind(this,t,i)),t.addEventListener("focusin",Ln.bind(this,t,i)),t.addEventListener("focusout",kn.bind(this,t,i)),t.addEventListener("keydown",xn.bind(this,t,i))}async function Yr(t,i){t.addEventListener("regular-table-psp-sort",o=>{this._preserve_focus_state=!0,i.restore({sort:o.detail.sort})})}customElements.define("perspective-viewer-datagrid",class extends HTMLElement{constructor(){super();this.datagrid=document.createElement("regular-table"),this.datagrid.formatters=Fr}async activate(t){let i=this.parentElement,o=await i.getTable(!0);this._initialized?await Kt(this.datagrid,o,t,this.model):(this.innerHTML="",this.appendChild(this.datagrid),this.model=await Kt(this.datagrid,o,t),Ir(this.datagrid,this.model),await Wr.call(this.model,this.datagrid,i),await Hr.call(this.model,this.datagrid,i),await Br.call(this.model,this.datagrid,i),await Yr.call(this.model,this.datagrid,i),this._initialized=!0)}get name(){return"Datagrid"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){}async draw(t){let i=this._save_column_size_overrides();await this.activate(t);let o=this.parentElement,l=this.datagrid.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.datagrid.scrollTop=0,this.datagrid.scrollLeft=0,Dr(this.datagrid,o),this.datagrid._resetAutoSize()),this._restore_column_size_overrides(i),await l}async update(t){this.model._num_rows=await t.num_rows(),await this.datagrid.draw()}async resize(){this._initialized&&await this.datagrid.draw()}async clear(){this.datagrid._resetAutoSize(),this.datagrid.clear()}save(){if(this.datagrid){let t=this.datagrid,i={};for(let l of Object.keys(t[ye]||{})){let d=Object.assign({},t[ye][l]);d?.pos_color&&(d.pos_color=d.pos_color[0],d.neg_color=d.neg_color[0]),i[l]=d}let o=this._save_column_size_overrides();for(let l of Object.keys(o||{}))i[l]||(i[l]={}),i[l].column_size_override=o[l];return JSON.parse(JSON.stringify(i))}return{}}restore(t){t=JSON.parse(JSON.stringify(t));let i={};for(let l of Object.keys(t)){let d=t[l];d.column_size_override!==void 0&&(i[l]=d.column_size_override,delete d.column_size_override),d?.pos_color&&(d.pos_color=mt(d.pos_color),d.neg_color=mt(d.neg_color)),Object.keys(d).length===0&&delete t[l]}let o=this.datagrid;try{o._resetAutoSize()}catch{}this._restore_column_size_overrides(i,!0),o[ye]=t}async restyle(){}delete(){this.datagrid.table_model&&this.datagrid._resetAutoSize(),this.datagrid.clear()}_save_column_size_overrides(){if(!this._initialized)return[];if(this._cached_column_sizes){let u=this._cached_column_sizes;return this._cached_column_sizes=void 0,u}let t=this.datagrid._column_sizes.override,{row_pivots:i,columns:o}=this.model._config,l=i?.length>0?i.length+1:0,d={};for(let u of Object.keys(t))if(t[u]!==void 0){let _=u-l;_>-1&&(d[this.model._column_paths[_]]=t[u])}return d}_restore_column_size_overrides(t,i=!1){if(!this._initialized)return;i&&(this._cached_column_sizes=t);let o={},{row_pivots:l,columns:d}=this.model._config,u=l?.length>0?l.length+1:0;for(let _ of Object.keys(t)){let v=this.model._column_paths.indexOf(_);o[v+u]=t[_]}this.datagrid._column_sizes.override=o}});function Mn(){let t=document.createElement("style");t.textContent=Rr,document.head.insertBefore(t,document.head.firstChild)}function En(){customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}customElements.whenDefined("perspective-viewer").then(En);Mn();})();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
//# sourceMappingURL=perspective-viewer-datagrid.js.map

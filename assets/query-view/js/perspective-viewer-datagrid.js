(()=>{var $r=Object.create;var Dt=Object.defineProperty;var Xr=Object.getOwnPropertyDescriptor;var Vr=Object.getOwnPropertyNames;var Ur=Object.getPrototypeOf,Kr=Object.prototype.hasOwnProperty;var Jr=t=>Dt(t,"__esModule",{value:!0});var Ht=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);var Zr=(t,s,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let l of Vr(s))!Kr.call(t,l)&&l!=="default"&&Dt(t,l,{get:()=>s[l],enumerable:!(o=Xr(s,l))||o.enumerable});return t},Tt=t=>Zr(Jr(Dt(t!=null?$r(Ur(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Er=Ht((Nn,Mr)=>{Mr.exports.default={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric"},null_value:-1}}}});var Nr=Ht((On,je)=>{var Cr=Er().default;je.exports.get_types=function(){return Object.keys(je.exports.get_config().types)};je.exports.get_type_config=function(t){let s={};if(je.exports.get_config().types[t]&&Object.assign(s,je.exports.get_config().types[t]),s.type){let o=je.exports.get_type_config(s.type);return Object.assign(o,s),o}else return s};function Yt(t){return t&&typeof t=="object"&&!Array.isArray(t)}function At(t,...s){if(!s.length)return t;let o=s.shift();if(Yt(t)&&Yt(o))for(let l in o)Yt(o[l])?(t[l]||Object.assign(t,{[l]:{}}),At(t[l],o[l])):Object.assign(t,{[l]:o[l]});return At(t,...s)}window.__PERSPECTIVE_CONFIG__=void 0;je.exports.override_config=function(t){window.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),window.__PERSPECTIVE_CONFIG__=At(Cr,t)};je.exports.get_config=function(){return window.__PERSPECTIVE_CONFIG__||(window.__PERSPECTIVE_CONFIG__=At(Cr,window.__TEMPLATE_CONFIG__||{})),window.__PERSPECTIVE_CONFIG__}});var $t=Ht((pt,gt)=>{(function(){var t,s,o,l,f,u,p,v,_,y,w,E,S,W,G,M,C,I,Q,g,$,oe,P,D,re,se,fe,ae,xe,Pe,ke,Ie,Ae,ne,Re,Se,We,de,Me,Fe,Ee,Te,ge,be,Ce,Je,Ne,he,Ge,xt,Zt,Y,Qt,er,tr,rr,ce,nr,sr,ir,or,ar,lr,cr,Ft,jt,Pt,fr,dr,ur,kt,Lt,hr,ve,_r,Ze,ye,It,ee,te,De,zt,Mt,Le=[].slice;ee=function(){var e,r,n,i,a;for(e={},a="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),i=0,r=a.length;i<r;i++)n=a[i],e["[object "+n+"]"]=n.toLowerCase();return function(c){var d;return d=Object.prototype.toString.call(c),e[d]||"object"}}(),he=function(e,r,n){return r==null&&(r=0),n==null&&(n=1),e<r&&(e=r),e>n&&(e=n),e},te=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},$=function(e){var r,n;for(e._clipped=!1,e._unclipped=e.slice(0),r=n=0;n<3;r=++n)r<3?((e[r]<0||e[r]>255)&&(e._clipped=!0),e[r]<0&&(e[r]=0),e[r]>255&&(e[r]=255)):r===3&&(e[r]<0&&(e[r]=0),e[r]>1&&(e[r]=1));return e._clipped||delete e._unclipped,e},l=Math.PI,ve=Math.round,D=Math.cos,xe=Math.floor,ce=Math.pow,Ge=Math.log,Ze=Math.sin,ye=Math.sqrt,W=Math.atan2,Y=Math.max,S=Math.abs,p=l*2,f=l/3,s=l/180,u=180/l,g=function(){return arguments[0]instanceof t?arguments[0]:function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,arguments,function(){})},g.default=g,E=[],typeof gt!="undefined"&&gt!==null&&gt.exports!=null&&(gt.exports=g),typeof define=="function"&&define.amd?define([],function(){return g}):(hr=typeof pt!="undefined"&&pt!==null?pt:this,hr.chroma=g),g.version="1.4.1",w={},_=[],y=!1,t=function(){function e(){var r,n,i,a,c,d,h,m,x;for(d=this,n=[],m=0,a=arguments.length;m<a;m++)r=arguments[m],r!=null&&n.push(r);if(n.length>1&&(h=n[n.length-1]),w[h]!=null)d._rgb=$(w[h](te(n.slice(0,-1))));else{for(y||(_=_.sort(function(L,F){return F.p-L.p}),y=!0),x=0,c=_.length;x<c&&(i=_[x],h=i.test.apply(i,n),!h);x++);h&&(d._rgb=$(w[h].apply(w,n)))}d._rgb==null&&console.warn("unknown format: "+n),d._rgb==null&&(d._rgb=[0,0,0]),d._rgb.length===3&&d._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),g._input=w;g.brewer=I={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,r;r=[];for(e in I)r.push(I[e.toLowerCase()]=I[e]);return r}(),De={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},g.colors=P=De,ge=function(){var e,r,n,i,a,c,d,h,m;return r=te(arguments),a=r[0],e=r[1],n=r[2],h=(a+16)/116,d=isNaN(e)?h:h+e/500,m=isNaN(n)?h:h-n/200,h=o.Yn*be(h),d=o.Xn*be(d),m=o.Zn*be(m),c=Mt(3.2404542*d-1.5371385*h-.4985314*m),i=Mt(-.969266*d+1.8760108*h+.041556*m),n=Mt(.0556434*d-.2040259*h+1.0572252*m),[c,i,n,r.length>3?r[3]:1]},Mt=function(e){return 255*(e<=.00304?12.92*e:1.055*ce(e,1/2.4)-.055)},be=function(e){return e>o.t1?e*e*e:o.t2*(e-o.t0)},o={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ft=function(){var e,r,n,i,a,c,d,h;return i=te(arguments),n=i[0],r=i[1],e=i[2],a=ur(n,r,e),c=a[0],d=a[1],h=a[2],[116*d-16,500*(c-d),200*(d-h)]},kt=function(e){return(e/=255)<=.04045?e/12.92:ce((e+.055)/1.055,2.4)},zt=function(e){return e>o.t3?ce(e,1/3):e/o.t2+o.t0},ur=function(){var e,r,n,i,a,c,d;return i=te(arguments),n=i[0],r=i[1],e=i[2],n=kt(n),r=kt(r),e=kt(e),a=zt((.4124564*n+.3575761*r+.1804375*e)/o.Xn),c=zt((.2126729*n+.7151522*r+.072175*e)/o.Yn),d=zt((.0193339*n+.119192*r+.9503041*e)/o.Zn),[a,c,d]},g.lab=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["lab"]),function(){})},w.lab=ge,t.prototype.lab=function(){return Ft(this._rgb)},G=function(e){var r,n,i,a,c,d,h,m,x,L,F;return e=function(){var z,k,N;for(N=[],k=0,z=e.length;k<z;k++)a=e[k],N.push(g(a));return N}(),e.length===2?(x=function(){var z,k,N;for(N=[],k=0,z=e.length;k<z;k++)a=e[k],N.push(a.lab());return N}(),c=x[0],d=x[1],r=function(z){var k,N;return N=function(){var A,R;for(R=[],k=A=0;A<=2;k=++A)R.push(c[k]+z*(d[k]-c[k]));return R}(),g.lab.apply(g,N)}):e.length===3?(L=function(){var z,k,N;for(N=[],k=0,z=e.length;k<z;k++)a=e[k],N.push(a.lab());return N}(),c=L[0],d=L[1],h=L[2],r=function(z){var k,N;return N=function(){var A,R;for(R=[],k=A=0;A<=2;k=++A)R.push((1-z)*(1-z)*c[k]+2*(1-z)*z*d[k]+z*z*h[k]);return R}(),g.lab.apply(g,N)}):e.length===4?(F=function(){var z,k,N;for(N=[],k=0,z=e.length;k<z;k++)a=e[k],N.push(a.lab());return N}(),c=F[0],d=F[1],h=F[2],m=F[3],r=function(z){var k,N;return N=function(){var A,R;for(R=[],k=A=0;A<=2;k=++A)R.push((1-z)*(1-z)*(1-z)*c[k]+3*(1-z)*(1-z)*z*d[k]+3*(1-z)*z*z*h[k]+z*z*z*m[k]);return R}(),g.lab.apply(g,N)}):e.length===5&&(n=G(e.slice(0,3)),i=G(e.slice(2,5)),r=function(z){return z<.5?n(z*2):i((z-.5)*2)}),r},g.bezier=function(e){var r;return r=G(e),r.scale=function(){return g.scale(r)},r},g.cubehelix=function(e,r,n,i,a){var c,d,h;return e==null&&(e=300),r==null&&(r=-1.5),n==null&&(n=1),i==null&&(i=1),a==null&&(a=[0,1]),c=0,ee(a)==="array"?d=a[1]-a[0]:(d=0,a=[a,a]),h=function(m){var x,L,F,z,k,N,A,R,U;return x=p*((e+120)/360+r*m),A=ce(a[0]+d*m,i),N=c!==0?n[0]+m*c:n,L=N*A*(1-A)/2,z=D(x),U=Ze(x),R=A+L*(-.14861*z+1.78277*U),k=A+L*(-.29227*z-.90649*U),F=A+L*(1.97294*z),g($([R*255,k*255,F*255,1]))},h.start=function(m){return m==null?e:(e=m,h)},h.rotations=function(m){return m==null?r:(r=m,h)},h.gamma=function(m){return m==null?i:(i=m,h)},h.hue=function(m){return m==null?n:(n=m,ee(n)==="array"?(c=n[1]-n[0],c===0&&(n=n[1])):c=0,h)},h.lightness=function(m){return m==null?a:(ee(m)==="array"?(a=m,d=m[1]-m[0]):(a=[m,m],d=0),h)},h.scale=function(){return g.scale(h)},h.hue(n),h},g.random=function(){var e,r,n,i;for(r="0123456789abcdef",e="#",n=i=0;i<6;n=++i)e+=r.charAt(xe(Math.random()*16));return new t(e)},E=[],Se=function(e,r,n,i){var a,c,d,h;for(n==null&&(n=.5),i==null&&(i="rgb"),ee(e)!=="object"&&(e=g(e)),ee(r)!=="object"&&(r=g(r)),d=0,c=E.length;d<c;d++)if(a=E[d],i===a[0]){h=a[1](e,r,n,i);break}if(h==null)throw"color mode "+i+" is not supported";return h.alpha(e.alpha()+n*(r.alpha()-e.alpha()))},g.interpolate=Se,t.prototype.interpolate=function(e,r,n){return Se(this,e,r,n)},g.mix=Se,t.prototype.mix=t.prototype.interpolate,w.rgb=function(){var e,r,n,i;r=te(arguments),n=[];for(e in r)i=r[e],n.push(i);return n},g.rgb=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(e){return e==null&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(e){return e==null&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},_.push({p:3,test:function(e){var r;if(r=te(arguments),ee(r)==="array"&&r.length===3||r.length===4&&ee(r[3])==="number"&&r[3]>=0&&r[3]<=1)return"rgb"}}),w.lrgb=w.rgb,Me=function(e,r,n,i){var a,c;return a=e._rgb,c=r._rgb,new t(ye(ce(a[0],2)*(1-n)+ce(c[0],2)*n),ye(ce(a[1],2)*(1-n)+ce(c[1],2)*n),ye(ce(a[2],2)*(1-n)+ce(c[2],2)*n),i)},v=function(e){var r,n,i,a,c,d;for(n=1/e.length,d=[0,0,0,0],a=0,i=e.length;a<i;a++)r=e[a],c=r._rgb,d[0]+=ce(c[0],2)*n,d[1]+=ce(c[1],2)*n,d[2]+=ce(c[2],2)*n,d[3]+=c[3]*n;return d[0]=ye(d[0]),d[1]=ye(d[1]),d[2]=ye(d[2]),d[3]>1&&(d[3]=1),new t($(d))},E.push(["lrgb",Me]),g.average=function(e,r){var n,i,a,c,d,h,m,x,L,F,z,k,N;if(r==null&&(r="rgb"),L=e.length,e=e.map(function(A){return g(A)}),m=e.splice(0,1)[0],r==="lrgb")return v(e);k=m.get(r),c=[],d=0,h=0;for(x in k)k[x]=k[x]||0,c.push(isNaN(k[x])?0:1),r.charAt(x)==="h"&&!isNaN(k[x])&&(n=k[x]/180*l,d+=D(n),h+=Ze(n));for(i=m.alpha(),z=0,F=e.length;z<F;z++){a=e[z],N=a.get(r),i+=a.alpha();for(x in k)isNaN(N[x])||(c[x]+=1,r.charAt(x)==="h"?(n=N[x]/180*l,d+=D(n),h+=Ze(n)):k[x]+=N[x])}for(x in k)if(r.charAt(x)==="h"){for(n=W(h/c[x],d/c[x])/l*180;n<0;)n+=360;for(;n>=360;)n-=360;k[x]=n}else k[x]=k[x]/c[x];return g(k,r).alpha(i/L)},ke=function(e){var r,n,i,a,c,d;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),d=parseInt(e,16),a=d>>16,i=d>>8&255,n=d&255,[a,i,n,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return e.length===9&&(e=e.substr(1)),d=parseInt(e,16),a=d>>24&255,i=d>>16&255,n=d>>8&255,r=ve((d&255)/255*100)/100,[a,i,n,r];if(w.css!=null&&(c=w.css(e)))return c;throw"unknown color: "+e},or=function(e,r){var n,i,a,c,d,h,m;return r==null&&(r="auto"),d=e[0],a=e[1],i=e[2],n=e[3],r==="auto"&&(r=n<1?"rgba":"rgb"),d=Math.round(d),a=Math.round(a),i=Math.round(i),m=d<<16|a<<8|i,h="000000"+m.toString(16),h=h.substr(h.length-6),c="0"+ve(n*255).toString(16),c=c.substr(c.length-2),"#"+function(){switch(r.toLowerCase()){case"rgba":return h+c;case"argb":return c+h;default:return h}}()},w.hex=function(e){return ke(e)},g.hex=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(e){return e==null&&(e="auto"),or(this._rgb,e)},_.push({p:4,test:function(e){if(arguments.length===1&&ee(e)==="string")return"hex"}}),ne=function(){var e,r,n,i,a,c,d,h,m,x,L,F,z,k;if(e=te(arguments),a=e[0],L=e[1],d=e[2],L===0)m=i=r=d*255;else{for(k=[0,0,0],n=[0,0,0],z=d<.5?d*(1+L):d+L-d*L,F=2*d-z,a/=360,k[0]=a+1/3,k[1]=a,k[2]=a-1/3,c=h=0;h<=2;c=++h)k[c]<0&&(k[c]+=1),k[c]>1&&(k[c]-=1),6*k[c]<1?n[c]=F+(z-F)*6*k[c]:2*k[c]<1?n[c]=z:3*k[c]<2?n[c]=F+(z-F)*(2/3-k[c])*6:n[c]=F;x=[ve(n[0]*255),ve(n[1]*255),ve(n[2]*255)],m=x[0],i=x[1],r=x[2]}return e.length>3?[m,i,r,e[3]]:[m,i,r]},lr=function(e,r,n){var i,a,c,d,h;return e!==void 0&&e.length>=3&&(d=e,e=d[0],r=d[1],n=d[2]),e/=255,r/=255,n/=255,c=Math.min(e,r,n),Y=Math.max(e,r,n),a=(Y+c)/2,Y===c?(h=0,i=Number.NaN):h=a<.5?(Y-c)/(Y+c):(Y-c)/(2-Y-c),e===Y?i=(r-n)/(Y-c):r===Y?i=2+(n-e)/(Y-c):n===Y&&(i=4+(e-r)/(Y-c)),i*=60,i<0&&(i+=360),[i,h,a]},g.hsl=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["hsl"]),function(){})},w.hsl=ne,t.prototype.hsl=function(){return lr(this._rgb)},Re=function(){var e,r,n,i,a,c,d,h,m,x,L,F,z,k,N,A,R,U;if(e=te(arguments),a=e[0],A=e[1],U=e[2],U*=255,A===0)m=i=r=U;else switch(a===360&&(a=0),a>360&&(a-=360),a<0&&(a+=360),a/=60,c=xe(a),n=a-c,d=U*(1-A),h=U*(1-A*n),R=U*(1-A*(1-n)),c){case 0:x=[U,R,d],m=x[0],i=x[1],r=x[2];break;case 1:L=[h,U,d],m=L[0],i=L[1],r=L[2];break;case 2:F=[d,U,R],m=F[0],i=F[1],r=F[2];break;case 3:z=[d,h,U],m=z[0],i=z[1],r=z[2];break;case 4:k=[R,d,U],m=k[0],i=k[1],r=k[2];break;case 5:N=[U,d,h],m=N[0],i=N[1],r=N[2]}return[m,i,r,e.length>3?e[3]:1]},cr=function(){var e,r,n,i,a,c,d,h,m;return d=te(arguments),c=d[0],n=d[1],e=d[2],a=Math.min(c,n,e),Y=Math.max(c,n,e),r=Y-a,m=Y/255,Y===0?(i=Number.NaN,h=0):(h=r/Y,c===Y&&(i=(n-e)/r),n===Y&&(i=2+(e-c)/r),e===Y&&(i=4+(c-n)/r),i*=60,i<0&&(i+=360)),[i,h,m]},g.hsv=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["hsv"]),function(){})},w.hsv=Re,t.prototype.hsv=function(){return cr(this._rgb)},tr=function(e){var r,n,i;return ee(e)==="number"&&e>=0&&e<=16777215?(i=e>>16,n=e>>8&255,r=e&255,[i,n,r,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},fr=function(){var e,r,n,i;return i=te(arguments),n=i[0],r=i[1],e=i[2],(n<<16)+(r<<8)+e},g.num=function(e){return new t(e,"num")},t.prototype.num=function(e){return e==null&&(e="rgb"),fr(this._rgb,e)},w.num=tr,_.push({p:1,test:function(e){if(arguments.length===1&&ee(e)==="number"&&e>=0&&e<=16777215)return"num"}}),Pe=function(){var e,r,n,i,a,c,d,h,m,x,L,F,z,k,N,A,R,U,ie,j;if(n=te(arguments),h=n[0],a=n[1],r=n[2],a=a/100,d=d/100*255,e=a*255,a===0)F=d=i=r;else switch(h===360&&(h=0),h>360&&(h-=360),h<0&&(h+=360),h/=60,m=xe(h),c=h-m,x=r*(1-a),L=x+e*(1-c),ie=x+e*c,j=x+e,m){case 0:z=[j,ie,x],F=z[0],d=z[1],i=z[2];break;case 1:k=[L,j,x],F=k[0],d=k[1],i=k[2];break;case 2:N=[x,j,ie],F=N[0],d=N[1],i=N[2];break;case 3:A=[x,L,j],F=A[0],d=A[1],i=A[2];break;case 4:R=[ie,x,j],F=R[0],d=R[1],i=R[2];break;case 5:U=[j,x,L],F=U[0],d=U[1],i=U[2]}return[F,d,i,n.length>3?n[3]:1]},ir=function(){var e,r,n,i,a,c,d,h,m;return m=te(arguments),h=m[0],a=m[1],r=m[2],d=Math.min(h,a,r),Y=Math.max(h,a,r),i=Y-d,n=i*100/255,e=d/(255-i)*100,i===0?c=Number.NaN:(h===Y&&(c=(a-r)/i),a===Y&&(c=2+(r-h)/i),r===Y&&(c=4+(h-a)/i),c*=60,c<0&&(c+=360)),[c,n,e]},g.hcg=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["hcg"]),function(){})},w.hcg=Pe,t.prototype.hcg=function(){return ir(this._rgb)},re=function(e){var r,n,i,a,c,d,h,m;if(e=e.toLowerCase(),g.colors!=null&&g.colors[e])return ke(g.colors[e]);if(c=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(h=c.slice(1,4),a=d=0;d<=2;a=++d)h[a]=+h[a];h[3]=1}else if(c=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(h=c.slice(1,5),a=m=0;m<=3;a=++m)h[a]=+h[a];else if(c=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(h=c.slice(1,4),a=r=0;r<=2;a=++r)h[a]=ve(h[a]*2.55);h[3]=1}else if(c=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(h=c.slice(1,5),a=n=0;n<=2;a=++n)h[a]=ve(h[a]*2.55);h[3]=+h[3]}else(c=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(i=c.slice(1,4),i[1]*=.01,i[2]*=.01,h=ne(i),h[3]=1):(c=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(i=c.slice(1,4),i[1]*=.01,i[2]*=.01,h=ne(i),h[3]=+c[4]);return h},sr=function(e){var r;if(r=e[3]<1?"rgba":"rgb",r==="rgb")return r+"("+e.slice(0,3).map(ve).join(",")+")";if(r==="rgba")return r+"("+e.slice(0,3).map(ve).join(",")+","+e[3]+")"},Lt=function(e){return ve(e*100)/100},Ae=function(e,r){var n;return n=r<1?"hsla":"hsl",e[0]=Lt(e[0]||0),e[1]=Lt(e[1]*100)+"%",e[2]=Lt(e[2]*100)+"%",n==="hsla"&&(e[3]=r),n+"("+e.join(",")+")"},w.css=function(e){return re(e)},g.css=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(e){if(e==null&&(e="rgb"),e.slice(0,3)==="rgb")return sr(this._rgb);if(e.slice(0,3)==="hsl")return Ae(this.hsl(),this.alpha())},w.named=function(e){return ke(De[e])},_.push({p:5,test:function(e){if(arguments.length===1&&De[e]!=null)return"named"}}),t.prototype.name=function(e){var r,n;arguments.length&&(De[e]&&(this._rgb=ke(De[e])),this._rgb[3]=1),r=this.hex("rgb");for(n in De)if(r===De[n])return n;return r},Ce=function(){var e,r,n,i;return i=te(arguments),n=i[0],e=i[1],r=i[2],r=r*s,[n,D(r)*e,Ze(r)*e]},Je=function(){var e,r,n,i,a,c,d,h,m,x,L;return n=te(arguments),h=n[0],a=n[1],d=n[2],x=Ce(h,a,d),e=x[0],r=x[1],i=x[2],L=ge(e,r,i),m=L[0],c=L[1],i=L[2],[m,c,i,n.length>3?n[3]:1]},Te=function(){var e,r,n,i,a,c;return c=te(arguments),a=c[0],e=c[1],r=c[2],n=ye(e*e+r*r),i=(W(r,e)*u+360)%360,ve(n*1e4)===0&&(i=Number.NaN),[a,n,i]},jt=function(){var e,r,n,i,a,c,d;return c=te(arguments),a=c[0],n=c[1],r=c[2],d=Ft(a,n,r),i=d[0],e=d[1],r=d[2],Te(i,e,r)},g.lch=function(){var e;return e=te(arguments),new t(e,"lch")},g.hcl=function(){var e;return e=te(arguments),new t(e,"hcl")},w.lch=Je,w.hcl=function(){var e,r,n,i;return i=te(arguments),r=i[0],e=i[1],n=i[2],Je([n,e,r])},t.prototype.lch=function(){return jt(this._rgb)},t.prototype.hcl=function(){return jt(this._rgb).reverse()},nr=function(e){var r,n,i,a,c,d,h,m,x;return e==null&&(e="rgb"),m=te(arguments),h=m[0],a=m[1],r=m[2],h=h/255,a=a/255,r=r/255,c=1-Math.max(h,Math.max(a,r)),i=c<1?1/(1-c):0,n=(1-h-c)*i,d=(1-a-c)*i,x=(1-r-c)*i,[n,d,x,c]},oe=function(){var e,r,n,i,a,c,d,h,m;return r=te(arguments),i=r[0],d=r[1],m=r[2],c=r[3],e=r.length>4?r[4]:1,c===1?[0,0,0,e]:(h=i>=1?0:255*(1-i)*(1-c),a=d>=1?0:255*(1-d)*(1-c),n=m>=1?0:255*(1-m)*(1-c),[h,a,n,e])},w.cmyk=function(){return oe(te(arguments))},g.cmyk=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return nr(this._rgb)},w.gl=function(){var e,r,n,i,a;for(i=function(){var c,d;c=te(arguments),d=[];for(r in c)a=c[r],d.push(a);return d}.apply(this,arguments),e=n=0;n<=2;e=++n)i[e]*=255;return i},g.gl=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},Pt=function(e,r,n){var i;return i=te(arguments),e=i[0],r=i[1],n=i[2],e=xt(e),r=xt(r),n=xt(n),.2126*e+.7152*r+.0722*n},xt=function(e){return e/=255,e<=.03928?e/12.92:ce((e+.055)/1.055,2.4)},Ee=function(e,r,n,i){var a,c;return a=e._rgb,c=r._rgb,new t(a[0]+n*(c[0]-a[0]),a[1]+n*(c[1]-a[1]),a[2]+n*(c[2]-a[2]),i)},E.push(["rgb",Ee]),t.prototype.luminance=function(e,r){var n,i,a,c,d;return r==null&&(r="rgb"),arguments.length?(c=this._rgb,e===0?c=[0,0,0,this._rgb[3]]:e===1?c=[255,255,255,this[3]]:(n=Pt(this._rgb),i=1e-7,a=20,d=function(h,m){var x,L;return L=h.interpolate(m,.5,r),x=L.luminance(),Math.abs(e-x)<i||!a--?L:x>e?d(h,L):d(L,m)},n>e?c=d(g("black"),this).rgba():c=d(this,g("white")).rgba()),g(c).alpha(this.alpha())):Pt(this._rgb)},It=function(e){var r,n,i,a;return a=e/100,a<66?(i=255,n=-155.25485562709179-.44596950469579133*(n=a-2)+104.49216199393888*Ge(n),r=a<20?0:-254.76935184120902+.8274096064007395*(r=a-10)+115.67994401066147*Ge(r)):(i=351.97690566805693+.114206453784165*(i=a-55)-40.25366309332127*Ge(i),n=325.4494125711974+.07943456536662342*(n=a-50)-28.0852963507957*Ge(n),r=255),[i,n,r]},dr=function(){var e,r,n,i,a,c,d,h,m;for(d=te(arguments),c=d[0],n=d[1],e=d[2],a=1e3,i=4e4,r=.4;i-a>r;)m=(i+a)*.5,h=It(m),h[2]/h[0]>=e/c?i=m:a=m;return ve(m)},g.temperature=g.kelvin=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["temperature"]),function(){})},w.temperature=w.kelvin=w.K=It,t.prototype.temperature=function(){return dr(this._rgb)},t.prototype.kelvin=t.prototype.temperature,g.contrast=function(e,r){var n,i,a,c;return((a=ee(e))==="string"||a==="number")&&(e=new t(e)),((c=ee(r))==="string"||c==="number")&&(r=new t(r)),n=e.luminance(),i=r.luminance(),n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)},g.distance=function(e,r,n){var i,a,c,d,h,m,x;n==null&&(n="lab"),((h=ee(e))==="string"||h==="number")&&(e=new t(e)),((m=ee(r))==="string"||m==="number")&&(r=new t(r)),c=e.get(n),d=r.get(n),x=0;for(a in c)i=(c[a]||0)-(d[a]||0),x+=i*i;return Math.sqrt(x)},g.deltaE=function(e,r,n,i){var a,c,d,h,m,x,L,F,z,k,N,A,R,U,ie,j,ze,we,q,K,_e,b,O,T,B,H,X;for(n==null&&(n=1),i==null&&(i=1),((ze=ee(e))==="string"||ze==="number")&&(e=new t(e)),((we=ee(r))==="string"||we==="number")&&(r=new t(r)),q=e.lab(),a=q[0],d=q[1],m=q[2],K=r.lab(),c=K[0],h=K[1],x=K[2],L=ye(d*d+m*m),F=ye(h*h+x*x),O=a<16?.511:.040975*a/(1+.01765*a),_e=.0638*L/(1+.0131*L)+.638,j=L<1e-6?0:W(m,d)*180/l;j<0;)j+=360;for(;j>=360;)j-=360;return T=j>=164&&j<=345?.56+S(.2*D(l*(j+168)/180)):.36+S(.4*D(l*(j+35)/180)),z=L*L*L*L,ie=ye(z/(z+1900)),b=_e*(ie*T+1-ie),U=a-c,R=L-F,N=d-h,A=m-x,k=N*N+A*A-R*R,B=U/(n*O),H=R/(i*_e),X=b,ye(B*B+H*H+k/(X*X))},t.prototype.get=function(e){var r,n,i,a,c,d;return i=this,c=e.split("."),a=c[0],r=c[1],d=i[a](),r?(n=a.indexOf(r),n>-1?d[n]:console.warn("unknown channel "+r+" in mode "+a)):d},t.prototype.set=function(e,r){var n,i,a,c,d,h;if(a=this,d=e.split("."),c=d[0],n=d[1],n)if(h=a[c](),i=c.indexOf(n),i>-1)if(ee(r)==="string")switch(r.charAt(0)){case"+":h[i]+=+r;break;case"-":h[i]+=+r;break;case"*":h[i]*=+r.substr(1);break;case"/":h[i]/=+r.substr(1);break;default:h[i]=+r}else h[i]=r;else console.warn("unknown channel "+n+" in mode "+c);else h=r;return g(h,c).alpha(a.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(e){return arguments.length?g.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},t.prototype.darken=function(e){var r,n;return e==null&&(e=1),n=this,r=n.lab(),r[0]-=o.Kn*e,g.lab(r).alpha(n.alpha())},t.prototype.brighten=function(e){return e==null&&(e=1),this.darken(-e)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(e){var r,n;return e==null&&(e=1),n=this,r=n.lch(),r[1]+=e*o.Kn,r[1]<0&&(r[1]=0),g.lch(r).alpha(n.alpha())},t.prototype.desaturate=function(e){return e==null&&(e=1),this.saturate(-e)},t.prototype.premultiply=function(){var e,r;return r=this.rgb(),e=this.alpha(),g(r[0]*e,r[1]*e,r[2]*e,e)},M=function(e,r,n){if(!M[n])throw"unknown blend mode "+n;return M[n](e,r)},C=function(e){return function(r,n){var i,a;return i=g(n).rgb(),a=g(r).rgb(),g(e(i,a),"rgb")}},ae=function(e){return function(r,n){var i,a,c;for(c=[],i=a=0;a<=3;i=++a)c[i]=e(r[i],n[i]);return c}},er=function(e,r){return e},Qt=function(e,r){return e*r/255},se=function(e,r){return e>r?r:e},Ne=function(e,r){return e>r?e:r},_r=function(e,r){return 255*(1-(1-e/255)*(1-r/255))},rr=function(e,r){return r<128?2*e*r/255:255*(1-2*(1-e/255)*(1-r/255))},Q=function(e,r){return 255*(1-(1-r/255)/(e/255))},fe=function(e,r){return e===255||(e=255*(r/255)/(1-e/255),e>255)?255:e},M.normal=C(ae(er)),M.multiply=C(ae(Qt)),M.screen=C(ae(_r)),M.overlay=C(ae(rr)),M.darken=C(ae(se)),M.lighten=C(ae(Ne)),M.dodge=C(ae(fe)),M.burn=C(ae(Q)),g.blend=M,g.analyze=function(e){var r,n,i,a;for(i={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},n=0,r=e.length;n<r;n++)a=e[n],a!=null&&!isNaN(a)&&(i.values.push(a),i.sum+=a,a<i.min&&(i.min=a),a>i.max&&(i.max=a),i.count+=1);return i.domain=[i.min,i.max],i.limits=function(c,d){return g.limits(i,c,d)},i},g.scale=function(e,r){var n,i,a,c,d,h,m,x,L,F,z,k,N,A,R,U,ie,j,ze,we,q,K,_e;return F="rgb",z=g("#ccc"),R=0,h=!1,d=[0,1],A=[],N=[0,0],n=!1,a=[],k=!1,L=0,x=1,c=!1,i={},U=!0,m=1,K=function(b){var O,T,B,H,X,Z;if(b==null&&(b=["#fff","#000"]),b!=null&&ee(b)==="string"&&g.brewer!=null&&(b=g.brewer[b]||g.brewer[b.toLowerCase()]||b),ee(b)==="array"){for(b.length===1&&(b=[b[0],b[0]]),b=b.slice(0),O=B=0,H=b.length-1;0<=H?B<=H:B>=H;O=0<=H?++B:--B)T=b[O],ee(T)==="string"&&(b[O]=g(T));for(A.length=0,O=Z=0,X=b.length-1;0<=X?Z<=X:Z>=X;O=0<=X?++Z:--Z)A.push(O/(b.length-1))}return q(),a=b},ze=function(b){var O,T;if(n!=null){for(T=n.length-1,O=0;O<T&&b>=n[O];)O++;return O-1}return 0},_e=function(b){return b},ie=function(b){var O,T,B,H,X;return X=b,n.length>2&&(H=n.length-1,O=ze(b),B=n[0]+(n[1]-n[0])*(0+R*.5),T=n[H-1]+(n[H]-n[H-1])*(1-R*.5),X=L+(n[O]+(n[O+1]-n[O])*.5-B)/(T-B)*(x-L)),X},we=function(b,O){var T,B,H,X,Z,J,le,V;if(O==null&&(O=!1),isNaN(b)||b===null)return z;if(O?V=b:n&&n.length>2?(T=ze(b),V=T/(n.length-2)):x!==L?V=(b-L)/(x-L):V=1,O||(V=_e(V)),m!==1&&(V=ce(V,m)),V=N[0]+V*(1-N[0]-N[1]),V=Math.min(1,Math.max(0,V)),X=Math.floor(V*1e4),U&&i[X])B=i[X];else{if(ee(a)==="array")for(H=Z=0,le=A.length-1;0<=le?Z<=le:Z>=le;H=0<=le?++Z:--Z){if(J=A[H],V<=J){B=a[H];break}if(V>=J&&H===A.length-1){B=a[H];break}if(V>J&&V<A[H+1]){V=(V-J)/(A[H+1]-J),B=g.interpolate(a[H],a[H+1],V,F);break}}else ee(a)==="function"&&(B=a(V));U&&(i[X]=B)}return B},q=function(){return i={}},K(e),j=function(b){var O;return O=g(we(b)),k&&O[k]?O[k]():O},j.classes=function(b){var O;return b!=null?(ee(b)==="array"?(n=b,d=[b[0],b[b.length-1]]):(O=g.analyze(d),b===0?n=[O.min,O.max]:n=g.limits(O,"e",b)),j):n},j.domain=function(b){var O,T,B,H,X,Z,J;if(!arguments.length)return d;if(L=b[0],x=b[b.length-1],A=[],B=a.length,b.length===B&&L!==x)for(X=0,H=b.length;X<H;X++)T=b[X],A.push((T-L)/(x-L));else for(O=J=0,Z=B-1;0<=Z?J<=Z:J>=Z;O=0<=Z?++J:--J)A.push(O/(B-1));return d=[L,x],j},j.mode=function(b){return arguments.length?(F=b,q(),j):F},j.range=function(b,O){return K(b,O),j},j.out=function(b){return k=b,j},j.spread=function(b){return arguments.length?(R=b,j):R},j.correctLightness=function(b){return b==null&&(b=!0),c=b,q(),c?_e=function(O){var T,B,H,X,Z,J,le,V,ue;for(T=we(0,!0).lab()[0],B=we(1,!0).lab()[0],le=T>B,H=we(O,!0).lab()[0],Z=T+(B-T)*O,X=H-Z,V=0,ue=1,J=20;Math.abs(X)>.01&&J-- >0;)(function(){return le&&(X*=-1),X<0?(V=O,O+=(ue-O)*.5):(ue=O,O+=(V-O)*.5),H=we(O,!0).lab()[0],X=H-Z})();return O}:_e=function(O){return O},j},j.padding=function(b){return b!=null?(ee(b)==="number"&&(b=[b,b]),N=b,j):N},j.colors=function(b,O){var T,B,H,X,Z,J,le,V,ue;if(arguments.length<2&&(O="hex"),J=[],arguments.length===0)J=a.slice(0);else if(b===1)J=[j(.5)];else if(b>1)B=d[0],T=d[1]-B,J=function(){le=[];for(var pe=0;0<=b?pe<b:pe>b;0<=b?pe++:pe--)le.push(pe);return le}.apply(this).map(function(pe){return j(B+pe/(b-1)*T)});else{if(e=[],V=[],n&&n.length>2)for(H=ue=1,Z=n.length;1<=Z?ue<Z:ue>Z;H=1<=Z?++ue:--ue)V.push((n[H-1]+n[H])*.5);else V=d;J=V.map(function(pe){return j(pe)})}return g[O]&&(J=J.map(function(pe){return pe[O]()})),J},j.cache=function(b){return b!=null?(U=b,j):U},j.gamma=function(b){return b!=null?(m=b,j):m},j.nodata=function(b){return b!=null?(z=g(b),j):z},j},g.scales==null&&(g.scales={}),g.scales.cool=function(){return g.scale([g.hsl(180,1,.9),g.hsl(250,.7,.4)])},g.scales.hot=function(){return g.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},g.analyze=function(e,r,n){var i,a,c,d,h,m,x;if(h={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},n==null&&(n=function(){return!0}),i=function(L){L!=null&&!isNaN(L)&&(h.values.push(L),h.sum+=L,L<h.min&&(h.min=L),L>h.max&&(h.max=L),h.count+=1)},x=function(L,F){if(n(L,F))return r!=null&&ee(r)==="function"?i(r(L)):r!=null&&ee(r)==="string"||ee(r)==="number"?i(L[r]):i(L)},ee(e)==="array")for(d=0,c=e.length;d<c;d++)m=e[d],x(m);else for(a in e)m=e[a],x(m,a);return h.domain=[h.min,h.max],h.limits=function(L,F){return g.limits(h,L,F)},h},g.limits=function(e,r,n){var i,a,c,d,h,m,x,L,F,z,k,N,A,R,U,ie,j,ze,we,q,K,_e,b,O,T,B,H,X,Z,J,le,V,ue,pe,Qe,et,tt,rt,nt,st,pr,it,ot,at,lt,ct,ft,dt,ut,ht,Yr,He,Et,gr,Oe,_t;if(r==null&&(r="equal"),n==null&&(n=7),ee(e)==="array"&&(e=g.analyze(e)),T=e.min,Y=e.max,Yr=e.sum,Oe=e.values.sort(function(Rt,Wt){return Rt-Wt}),n===1)return[T,Y];if(b=[],r.substr(0,1)==="c"&&(b.push(T),b.push(Y)),r.substr(0,1)==="e"){for(b.push(T),q=le=1,Qe=n-1;1<=Qe?le<=Qe:le>=Qe;q=1<=Qe?++le:--le)b.push(T+q/n*(Y-T));b.push(Y)}else if(r.substr(0,1)==="l"){if(T<=0)throw"Logarithmic scales are only possible for values > 0";for(B=Math.LOG10E*Ge(T),O=Math.LOG10E*Ge(Y),b.push(T),q=_t=1,et=n-1;1<=et?_t<=et:_t>=et;q=1<=et?++_t:--_t)b.push(ce(10,B+q/n*(O-B)));b.push(Y)}else if(r.substr(0,1)==="q"){for(b.push(T),q=i=1,it=n-1;1<=it?i<=it:i>=it;q=1<=it?++i:--i)V=(Oe.length-1)*q/n,ue=xe(V),ue===V?b.push(Oe[ue]):(pe=V-ue,b.push(Oe[ue]*(1-pe)+Oe[ue+1]*pe));b.push(Y)}else if(r.substr(0,1)==="k"){for(X=Oe.length,R=new Array(X),ze=new Array(n),ht=!0,Z=0,ie=null,ie=[],ie.push(T),q=a=1,ot=n-1;1<=ot?a<=ot:a>=ot;q=1<=ot?++a:--a)ie.push(T+q/n*(Y-T));for(ie.push(Y);ht;){for(K=c=0,at=n-1;0<=at?c<=at:c>=at;K=0<=at?++c:--c)ze[K]=0;for(q=d=0,lt=X-1;0<=lt?d<=lt:d>=lt;q=0<=lt?++d:--d){for(gr=Oe[q],H=Number.MAX_VALUE,K=h=0,ct=n-1;0<=ct?h<=ct:h>=ct;K=0<=ct?++h:--h)we=S(ie[K]-gr),we<H&&(H=we,U=K);ze[U]++,R[q]=U}for(J=new Array(n),K=m=0,ft=n-1;0<=ft?m<=ft:m>=ft;K=0<=ft?++m:--m)J[K]=null;for(q=x=0,dt=X-1;0<=dt?x<=dt:x>=dt;q=0<=dt?++x:--x)j=R[q],J[j]===null?J[j]=Oe[q]:J[j]+=Oe[q];for(K=L=0,ut=n-1;0<=ut?L<=ut:L>=ut;K=0<=ut?++L:--L)J[K]*=1/ze[K];for(ht=!1,K=F=0,tt=n-1;0<=tt?F<=tt:F>=tt;K=0<=tt?++F:--F)if(J[K]!==ie[q]){ht=!0;break}ie=J,Z++,Z>200&&(ht=!1)}for(_e={},K=z=0,rt=n-1;0<=rt?z<=rt:z>=rt;K=0<=rt?++z:--z)_e[K]=[];for(q=k=0,nt=X-1;0<=nt?k<=nt:k>=nt;q=0<=nt?++k:--k)j=R[q],_e[j].push(Oe[q]);for(He=[],K=N=0,st=n-1;0<=st?N<=st:N>=st;K=0<=st?++N:--N)He.push(_e[K][0]),He.push(_e[K][_e[K].length-1]);for(He=He.sort(function(Rt,Wt){return Rt-Wt}),b.push(He[0]),q=A=1,pr=He.length-1;A<=pr;q=A+=2)Et=He[q],!isNaN(Et)&&b.indexOf(Et)===-1&&b.push(Et)}return b},Ie=function(e,r,n){var i,a,c,d;return i=te(arguments),e=i[0],r=i[1],n=i[2],isNaN(e)&&(e=0),e/=360,e<1/3?(a=(1-r)/3,d=(1+r*D(p*e)/D(f-p*e))/3,c=1-(a+d)):e<2/3?(e-=1/3,d=(1-r)/3,c=(1+r*D(p*e)/D(f-p*e))/3,a=1-(d+c)):(e-=2/3,c=(1-r)/3,a=(1+r*D(p*e)/D(f-p*e))/3,d=1-(c+a)),d=he(n*d*3),c=he(n*c*3),a=he(n*a*3),[d*255,c*255,a*255,i.length>3?i[3]:1]},ar=function(){var e,r,n,i,a,c,d,h;return d=te(arguments),c=d[0],r=d[1],e=d[2],p=Math.PI*2,c/=255,r/=255,e/=255,a=Math.min(c,r,e),i=(c+r+e)/3,h=1-a/i,h===0?n=0:(n=(c-r+(c-e))/2,n/=Math.sqrt((c-r)*(c-r)+(c-e)*(r-e)),n=Math.acos(n),e>r&&(n=p-n),n/=p),[n*360,h,i]},g.hsi=function(){return function(e,r,n){n.prototype=e.prototype;var i=new n,a=e.apply(i,r);return Object(a)===a?a:i}(t,Le.call(arguments).concat(["hsi"]),function(){})},w.hsi=Ie,t.prototype.hsi=function(){return ar(this._rgb)},We=function(e,r,n,i){var a,c,d,h,m,x,L,F,z,k,N,A,R;return i==="hsl"?(A=e.hsl(),R=r.hsl()):i==="hsv"?(A=e.hsv(),R=r.hsv()):i==="hcg"?(A=e.hcg(),R=r.hcg()):i==="hsi"?(A=e.hsi(),R=r.hsi()):(i==="lch"||i==="hcl")&&(i="hcl",A=e.hcl(),R=r.hcl()),i.substr(0,1)==="h"&&(d=A[0],k=A[1],x=A[2],h=R[0],N=R[1],L=R[2]),!isNaN(d)&&!isNaN(h)?(h>d&&h-d>180?a=h-(d+360):h<d&&d-h>180?a=h+360-d:a=h-d,c=d+n*a):isNaN(d)?isNaN(h)?c=Number.NaN:(c=h,(x===1||x===0)&&i!=="hsv"&&(z=N)):(c=d,(L===1||L===0)&&i!=="hsv"&&(z=k)),z==null&&(z=k+n*(N-k)),m=x+n*(L-x),F=g[i](c,z,m)},E=E.concat(function(){var e,r,n,i;for(n=["hsv","hsl","hsi","hcl","lch","hcg"],i=[],r=0,e=n.length;r<e;r++)Zt=n[r],i.push([Zt,We]);return i}()),Fe=function(e,r,n,i){var a,c;return a=e.num(),c=r.num(),g.num(a+(c-a)*n,"num")},E.push(["num",Fe]),de=function(e,r,n,i){var a,c,d;return c=e.lab(),d=r.lab(),a=new t(c[0]+n*(d[0]-c[0]),c[1]+n*(d[1]-c[1]),c[2]+n*(d[2]-c[2]),i)},E.push(["lab",de])}).call(pt)});var qe=new WeakMap,Qr=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function mr(t,s,o){return s in t?Object.defineProperty(t,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[s]=o,t}function br(t,s,o,l,f){var u={};return Object.keys(l).forEach(function(p){u[p]=l[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=o.slice().reverse().reduce(function(p,v){return v(t,s,p)||p},u),f&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(f):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(t,s,u),u=null),u}var Ct=0,Ve=0,vr=performance.now(),wr=(t,...s)=>t.map((o,l)=>[o,s[l]]).flat().filter(o=>!!o).join("");function yr(t,s,o){let l=Symbol("private lock"),f=o.value;return o.value=async function(...u){if(this[l]&&(await this[l],this[l]))return void await this[l];let p;this[l]=(()=>{let v,_=new Promise(y=>{v=y});return _.resolve=v,_})();try{p=await f.call(this,...u)}finally{let v=this[l];this[l]=void 0,v.resolve()}return p},o.value.flush=function(){return this[l]},o}var Nt;function Gt(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(Gt.prototype,HTMLElement.prototype),Object.setPrototypeOf(Gt,HTMLElement);var en=(br((Nt=class extends Gt{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=wr` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;let[,t,s]=this.shadowRoot.children;this._table_clip=s,this._virtual_panel=t,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode!=="both"&&this._virtual_mode!=="vertical"||(this._table_clip.style.top="0px"),this._virtual_mode!=="both"&&this._virtual_mode!=="horizontal"||(this._table_clip.style.left="0px"))}_calculate_viewport(t,s,o,l){let{start_row:f,end_row:u}=this._calculate_row_range(t,o),{start_col:p,end_col:v}=this._calculate_column_range(s,l);return this._nrows=t,{start_col:p,end_col:v,start_row:f,end_row:u}}_calculate_row_range(t,s){let{height:o}=this._container_size,l=this._column_sizes.row_height||19,f=this._view_cache.config.column_pivots.length+1,u=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),p=Math.max(this.scrollTop,0)/u,v=o/l,_=s?t:this._nrows||0,y=Math.max(0,_+(f-v)),w=Math.ceil(y*p);return{start_row:w,end_row:Math.min(Math.ceil(w+v),t)}}_calculate_column_range(t,s){let o=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),l=this.scrollLeft/o,f=this._max_scroll_column(t)+.5;if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let u=Math.floor(f*l);return{start_col:u,end_col:u+(!s&&this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(t){let s=0;if(this._view_cache.config.row_pivots.length>0)for(let l of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))s+=l;let o=t;for(;s<this._container_size.width&&o>=0;)o--,s+=this._column_sizes.indices[o]||60;return Math.min(t-1,o+1)}_validate_viewport({start_col:t,end_col:s,start_row:o,end_row:l}){let f=this._start_col!==t,u=this._start_row!==o||this._end_row!==l||this._end_col!==s;return this._start_col=t,this._end_col=s,this._start_row=o,this._end_row=l,{invalid_column:f,invalid_row:u}}_update_virtual_panel_width(t,s){if(t)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((o,l)=>o+l,0)+"px";else{let o=Math.max(1,this._virtual_panel.offsetWidth-this._container_size.width),l=this.scrollLeft/o,f=this._max_scroll_column(s),u=0,p=0;for(;u<f;)p+=this._column_sizes.indices[u]||60,u++;let v=this._container_size.width+p;this._virtual_panel.style.width=v+"px",this.scrollLeft=l*p}}_update_virtual_panel_height(t){let{row_height:s=19}=this._column_sizes,o=this.table_model.header.num_rows()*s,l;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")l=t*s+o;else{let f=this.clientHeight/(this._table_clip.offsetHeight-o);l=Math.min(Qr,t*s*f)}this._virtual_panel.style.height=l+"px"}async draw(t={}){let s=performance.now(),{invalid_viewport:o=!0,preserve_width:l=!1,reset_scroll_position:f=!1,invalid_columns:u=!1}=t;f&&this.reset_scroll(),this._invalid_schema=u||this._invalid_schema;let{num_columns:p,num_rows:v}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight};let _=this._calculate_viewport(v,p,f,u),{invalid_row:y,invalid_column:w}=this._validate_viewport(_);if(this._update_virtual_panel_height(v),this._invalid_schema||y||w||o||w){this.dispatchEvent(new CustomEvent("regular-table-before-update",{bubbles:!0,detail:this}));let S=[];for await(S of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,l,_,p)){this._is_styling=!0;let W=this._style_callbacks;for(let G of W)await G({detail:this});if(this._is_styling=!1,!this._invalidated&&S!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(S),this.table_model.header.reset_header_cache(),l||this._update_virtual_panel_width(this._invalid_schema||w||o,p),this._invalid_schema=!1}var E;E=performance.now()-s,Ct=(Ct*Ve+E)/(Ve+1),Ve+=1}}).prototype,"draw",[yr],Object.getOwnPropertyDescriptor(Nt.prototype,"draw"),Nt.prototype),Nt),Ot,tn=(br((Ot=class extends en{register_listeners(){this.addEventListener("mousedown",this._on_click.bind(this)),this.addEventListener("dblclick",this._on_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!1}),this._register_glitch_scroll_listeners()}async _on_scroll(t){t.stopPropagation(),t.returnValue=!1,await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this),{passive:!1}),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!1}),this.addEventListener("touchmove",this._on_touchmove.bind(this),{passive:!1})}_on_mousewheel(t){if(!window.safari)return;let{clientWidth:s,clientHeight:o,scrollTop:l,scrollLeft:f,scrollHeight:u}=this;if(t.deltaY>0&&l+o>=u||t.deltaY<0&&l<=0){t.preventDefault(),t.returnValue=!1;let p=Math.max(1,this._virtual_panel.offsetHeight-o),v=Math.max(1,this._virtual_panel.offsetWidth-s);this.scrollTop=Math.min(p,l+t.deltaY),this.scrollLeft=Math.min(v,f+t.deltaX),this._on_scroll(t)}}_on_touchmove(t){t.preventDefault(),t.returnValue=!1;let{clientWidth:s,clientHeight:o,scrollTop:l,scrollLeft:f}=this,u=Math.max(1,this._virtual_panel.offsetHeight-o),p=Math.max(1,this._virtual_panel.offsetWidth-s);this.scrollTop=Math.min(u,l+(this._memo_touch_startY-t.touches[0].screenY)),this.scrollLeft=Math.min(p,f+(this._memo_touch_startX-t.touches[0].screenX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].screenY,this._memo_touch_startX=t.touches[0].screenX}async _on_dblclick(t){let s=t.target;for(;s.tagName!=="TD"&&s.tagName!=="TH";)if(s=s.parentElement,!this.contains(s))return;let o=t.target.classList.contains("rt-column-resize"),l=qe.get(s);if(o){t.stopImmediatePropagation(),s.style.minWidth="",s.style.maxWidth="",t.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(delete this._column_sizes.override[l.size_key],delete this._column_sizes.auto[l.size_key],delete this._column_sizes.indices[l.size_key]);for(let f of t.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let u of t.shiftKey?f:[f[l._virtual_x]])u&&(u.style.minWidth="",u.style.maxWidth="",u.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(t){if(t.button!==0)return;let s=t.target;for(;s.tagName!=="TD"&&s.tagName!=="TH";)if(s=s.parentElement,!this.contains(s))return;let o=t.target.classList.contains("rt-column-resize"),l=qe.get(s);o&&(this._on_resize_column(t,s,l),t.stopImmediatePropagation())}_on_resize_column(t,s,o){let{_virtual_x:l,size_key:f}=o,u=t.pageX,p=l+s.colSpan-1,v=this.table_model.header.get_column_header(p),_=this._column_sizes.indices[f],y=E=>this._on_resize_column_move(E,v,u,_,f,p),w=()=>{document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",w);let E=this._column_sizes.override[f],S=this._column_sizes.indices[f]!==E;this._column_sizes.indices[f]=E,S&&this.draw()};document.addEventListener("mousemove",y),document.addEventListener("mouseup",w)}async _on_resize_column_move(t,s,o,l,f,u){await new Promise(setTimeout);let p=t.pageX-o,v=Math.max(1,l+p);if(this._column_sizes.override[f]=v,p<0)await this.draw({preserve_width:!0});else{s.style.minWidth=v+"px",s.style.maxWidth=v+"px";let _=this._column_sizes.auto[f];for(let y of this.table_model.body.cells){let w=y[u];w&&(w.style.maxWidth=w.style.minWidth=v+"px",w.classList.toggle("rt-cell-clip",_>v))}}}}).prototype,"_on_resize_column_move",[yr],Object.getOwnPropertyDescriptor(Ot.prototype,"_on_resize_column_move"),Ot.prototype),Ot),xr=class{constructor(s){this._name=s,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let s=this._elements[this._index];return this._index+=1,s}},qt=class{constructor(s,o,l){this._column_sizes=s,this._container=o,this._span_factory=new xr("span"),this.table=l,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(s,o){qe.set(s,o)}_get_or_create_metadata(s){if(s===void 0)return{};if(qe.has(s))return qe.get(s);{let o={};return qe.set(s,o),o}}_replace_cell(s,o){let{tr:l,row_container:f}=this._get_row(s),u=f[o];return u&&(l.removeChild(u),f.splice(o,1,void 0)),u}_fetch_cell(s,o){if(s<0||o<0)return;let{row_container:l}=this._get_row(s);return l[o]}_get_cell(s="TD",o,l){let{tr:f,row_container:u}=this._get_row(o),p=u[l];if(p||(l<u.length?(p=u[l]=document.createElement(s),f.insertBefore(p,u.slice(l+1).find(v=>v))):(p=u[l]=document.createElement(s),f.appendChild(p))),p.tagName!==s){let v=document.createElement(s);f.replaceChild(v,p),this.cells[o].splice(l,1,v),p=v}return p}_get_row(s){let o=this.rows[s];o||(o=this.rows[s]=document.createElement("tr"),this.table.appendChild(o));let l=this.cells[s];return l||(l=this.cells[s]=[]),{tr:o,row_container:l}}_clean_columns(s){for(let o=0;o<this.rows.length;o++){let l=this.rows[o],f=this.cells[o];this.cells[o]=f.slice(0,s[o]||s);let u=this.cells[o].filter(p=>p!==void 0).length;for(;l.children[u];)l.removeChild(l.children[u])}}_clean_rows(s){for(;this.table.children[s];)this.table.removeChild(this.table.children[s]);this.rows=this.rows.slice(0,s),this.cells=this.cells.slice(0,s)}},kr=class extends qt{constructor(...s){super(...s),mr(this,"_group_header_cache",[]),mr(this,"_offset_cache",[])}_draw_group_th(s,o,l){let f=this._get_cell("TH",o,s[o]||0);if(s[o]+=1,f.removeAttribute("colspan"),f.style.minWidth="0",f.textContent="",l instanceof HTMLElement)f.appendChild(l);else{let p=this._span_factory.get("span");p.textContent=l,f.appendChild(p)}let u=this._span_factory.get("span");return u.className="rt-column-resize",f.appendChild(u),f}_draw_group(s,o,l){let f=this._get_or_create_metadata(l);return f.column_header=s,f.value=o,f.value=o,f}_draw_th(s,o,l,f,u){let p=this._get_or_create_metadata(l);if(p.column_header=s,p.value=o,p.size_key=u.length?u[0]:u,!(u.length>1)){let v=this._column_sizes.override[p.size_key],_=this._column_sizes.auto[p.size_key];v?(l.classList.toggle("rt-cell-clip",_>v),l.style.minWidth=v+"px",l.style.maxWidth=v+"px"):_?(l.classList.remove("rt-cell-clip"),l.style.maxWidth="",l.style.minWidth=_+"px"):(l.style.maxWidth="",l.style.maxWidth="")}return p}get_column_header(s){return this._get_cell("TH",this.num_rows()-1,s)}draw(s,o,l,f,u,p,v){let _=o==null?void 0:o.length;if(_===0)return{};let y,w,E;for(let M=0;M<_;M++){if(E=o[M]?o[M]:"",this._offset_cache[M]=this._offset_cache[M]||0,M<_-1){var S,W,G;((S=this._group_header_cache)===null||S===void 0||(W=S[M])===null||W===void 0||(G=W[0])===null||G===void 0?void 0:G.value)===E?(y=this._group_header_cache[M][1],this._group_header_cache[M][2]+=1,l===1&&(this._group_header_cache[M][0].row_header_x=u),y.setAttribute("colspan",this._group_header_cache[M][2])):(y=this._draw_group_th(this._offset_cache,M,E),w=this._draw_group(o,E,y),this._group_header_cache[M]=[w,y,1])}else{y=this._draw_group_th(this._offset_cache,M,E),w=this._draw_th(s||o,E,y,f,u);for(let[C]of this._group_header_cache)C.size_key=w.size_key;y.removeAttribute("colspan")}w&&(w.x=f,w.column_header_y=M,w.x0=p,w._virtual_x=v,l===1&&(w.row_header_x=u))}return this._clean_rows(this._offset_cache.length),{th:y,metadata:w}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Lr=class extends qt{_draw_td(s,o,l,f,{column_name:u},{ridx_offset:p},v){let _=this._get_cell(s,o,f),y=this._get_or_create_metadata(_);y.y=o+p,y.size_key=v,s==="TD"&&(y.column_header=u);let w=this._column_sizes.override[y.size_key];if(w){let E=this._column_sizes.auto[y.size_key];_.classList.toggle("rt-cell-clip",E>w),_.style.minWidth=w+"px",_.style.maxWidth=w+"px"}else _.classList.remove("rt-cell-clip"),_.style.minWidth="",_.style.maxWidth="";return l instanceof HTMLElement?(_.textContent="",_.appendChild(l)):_.textContent=l,y.value=l,{td:_,metadata:y}}draw(s,o,l,f=!1,u,p,v){let{cidx:_,column_data:y,row_headers:w,column_data_listener_metadata:E}=o,S,{row_height:W}=l,G=[],M=[],C=0,I=[];for(let g=0;g<(f?l.row_headers_length:1);g++){C=0;for(let $ of y){var Q;let oe=w==null?void 0:w[C],P;if(f){let D=$[g],re=this._fetch_cell(C-(G[g]||1),_+g),se=this._get_or_create_metadata(re),fe=this._fetch_cell(C,_+g-(I[C]||1)),ae=this._get_or_create_metadata(fe);!fe||ae.value!==D&&D!==void 0||fe.hasAttribute("rowspan")?re&&se.value===D&&!re.hasAttribute("colspan")?(G[g]=G[g]?G[g]+1:2,re.setAttribute("rowspan",G[g]),this._replace_cell(C,_+g)):(P=this._draw_td("TH",C,D,_+g,o,l,g),P.td.style.display="",P.td.removeAttribute("rowspan"),P.td.removeAttribute("colspan"),P.metadata.row_header=$,P.metadata.row_header_x=g,P.metadata.x0=p,P.metadata.y0=l.ridx_offset,P.metadata.y1=l.y1,P.metadata._virtual_x=g,G[g]=1,I[C]=1,M[g]=P):(I[C]=I[C]?I[C]+1:2,fe.setAttribute("colspan",I[C]),this._replace_cell(C,_+g))}else P=this._draw_td("TD",C,$,_,o,l,v),E&&(P.metadata.user=E[C]),P.metadata.x=u,P.metadata.x0=p,P.metadata.x1=l.x1,P.metadata.row_header=oe||[],P.metadata.y0=l.ridx_offset,P.metadata.y1=l.y1,P.metadata.dx=u-p,P.metadata.dy=P.metadata.y-P.metadata.y0,P.metadata._virtual_x=_,M[0]=P;if(C++,S=P?P.metadata:S,W=W||((Q=P)===null||Q===void 0?void 0:Q.td.offsetHeight),C*W>s)break}}return this._clean_rows(C),{tds:M,ridx:C,metadata:S,row_height:W}}clean({ridx:s,cidx:o}){this._clean_rows(s),this._clean_columns(o)}},Bt=class{constructor(s,o,l){this.clear(l);let[f]=l.children,[u,p]=f.children;this.table=f,this._column_sizes=o,this.header=new kr(o,s,u),this.body=new Lr(o,s,p),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(s){s.innerHTML=wr` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(s){for(;s.length>0;){let[o,l,f]=s.pop(),u,p=getComputedStyle(o);p.boxSizing!=="border-box"?(u=o.clientWidth,u-=parseFloat(p.paddingLeft),u-=parseFloat(p.paddingRight)):u=parseFloat(window.getComputedStyle(o).width),this._column_sizes.row_height=this._column_sizes.row_height||f.offsetHeight,this._column_sizes.indices[l.size_key]=u;let v=this._column_sizes.override.hasOwnProperty(l.size_key);u&&!v&&(this._column_sizes.auto[l.size_key]=u),o.style.minWidth==="0px"&&(o.style.minWidth=u+"px")}}async*draw(s,o,l,f,u,p){var v,_,y,w;let{width:E,height:S}=s,{view:W,config:G}=o,{data:M,row_headers:C,column_headers:I,metadata:Q}=await W(u.start_col,u.start_row,u.end_col,u.end_row),{start_row:g=0,start_col:$=0,end_col:oe=0,end_row:P=0}=u;C&&(this._row_headers_length=C.reduce((ne,Re)=>Math.max(ne,Re.length),0),C=C.map(ne=>(ne.length=this._row_headers_length,ne))),o.config.column_pivots=Array.from(Array((I==null||(v=I[0])===null||v===void 0?void 0:v.length)-1||0).keys()),o.config.row_pivots=Array.from(Array(((_=C)===null||_===void 0||(y=_[0])===null||y===void 0?void 0:y.length)||0).keys());let D={viewport_width:0,selected_id:l,ridx_offset:g,x0:$,x1:oe,y1:P,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},re,se=0,fe=[],ae=!0;if(((w=C)===null||w===void 0?void 0:w.length)>0){let ne=G.row_pivots.join(","),Re={column_name:ne,cidx:0,column_data:C,row_headers:C,first_col:ae},Se=se+$;re=this.body.draw(S,Re,{...D,x0:0},!0,void 0,void 0,Se);let We=[];for(let de=0;de<o.config.row_pivots.length;de++)We.push(this.header.draw(ne,Array(o.config.column_pivots.length+1).fill(""),1,void 0,de,$,de));if(ae=!1,D.viewport_width+=We.reduce((de,{th:Me},Fe)=>de+(this._column_sizes.indices[Fe]||Me.offsetWidth),0),D.row_height=D.row_height||re.row_height,se=C[0].length,!f)for(let de=0;de<o.config.row_pivots.length;de++){let{td:Me,metadata:Fe}=re.tds[de]||{},{th:Ee,metadata:Te}=We[de];fe.push([Ee||Me,Te||Fe,Me||Ee])}}try{var xe;let ne=0,Re=p-u.start_col;for(;ne<Re;){if(!M[ne]){let ge=Math.max(u.end_col,0);u.start_col=ge;let be=0,Ce=0;for(;this._column_sizes.indices.length>se+$+be+1&&Ce+D.viewport_width<E;)be++,Ce+=this._column_sizes.indices[se+$+be];if(Ce+D.viewport_width<E){let he=Math.min(p,ge+5);u.end_col=Math.max(1,Math.min(p,he))}else u.end_col=Math.max(1,Math.min(p,ge+be));let Je=W(u.start_col,u.start_row,u.end_col,u.end_row);yield;let Ne=await Je;if(Ne.data.length===0)return void(yield fe);u.end_col=u.start_col+Ne.data.length;for(let he=0;he<Ne.data.length;he++){var Pe;M[ne+he]=Ne.data[he],Ne.metadata&&(Q[ne+he]=Ne.metadata[he]),I&&(I[ne+he]=(Pe=Ne.column_headers)===null||Pe===void 0?void 0:Pe[he])}}let Se=(I==null?void 0:I[ne])||"",We=M[ne],de={column_name:Se,cidx:se,column_data:We,column_data_listener_metadata:Q==null?void 0:Q[ne],row_headers:C,first_col:ae},Me=ne+$,Fe=se+$,Ee=this.header.draw(void 0,Se,void 0,Me,Fe,$,se);if(re=this.body.draw(S,de,D,!1,Me,$,Fe),ae=!1,!f)for(let{td:ge,metadata:be}of re.tds)fe.push([Ee.th||ge,Ee.metadata||be,ge||Ee.th]);let Te=this._column_sizes.indices[se+$];var ke;if(Te?D.viewport_width+=Te:D.viewport_width+=((ke=Ee.th)===null||ke===void 0?void 0:ke.offsetWidth)||re.tds.reduce((ge,be)=>{var Ce;return ge+((Ce=be.td)===null||Ce===void 0?void 0:Ce.offsetWidth)},0),D.row_height=D.row_height||re.row_height,se++,ne++,D.viewport_width>E){var Ie;this.body.clean({ridx:((Ie=re)===null||Ie===void 0?void 0:Ie.ridx)||0,cidx:se}),this.header.clean(),yield fe,D.viewport_width=0;for(let[ge]of fe)D.viewport_width+=ge.offsetWidth;if(D.viewport_width>E)return}}this.body.clean({ridx:((xe=re)===null||xe===void 0?void 0:xe.ridx)||0,cidx:se}),this.header.clean(),yield fe}finally{var Ae;this.body.clean({ridx:((Ae=re)===null||Ae===void 0?void 0:Ae.ridx)||0,cidx:se}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},rn=["both","horizontal","vertical","none"],zr=class extends tn{constructor(){super(),this._column_sizes={auto:{},override:{},indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new Bt(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto={},this._column_sizes.override={},this._column_sizes.indices=[];for(let s=0;s<this.table_model.header.num_columns();s++){let o=this.table_model.header.get_column_header(s);o.style.minWidth="",o.style.maxWidth=""}}clear(){this.table_model=new Bt(this._table_clip,this._column_sizes,this)}addStyleListener(s){this._style_callbacks=this._style_callbacks.concat(s);let o=!0;return()=>{if(!o)return;o=!1;let l=this._style_callbacks=this._style_callbacks.slice(),f=l.indexOf(s);l.splice(f,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(s){if(s!==void 0){if(s instanceof HTMLElement)return qe.get(s);if(s.row_header_x>=0){if(s.row_header_x<this._view_cache.config.row_pivots.length){let o=this.table_model.body._fetch_cell(s.y,s.row_header_x);return this.getMeta(o)}}else{if(!(s.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(s.dy,s.dx+this.table_model._row_headers_length));if(s.column_header_y<this._view_cache.config.column_pivots.length){let o=this.table_model.body._fetch_cell(s.column_header_y,s.y);return this.getMeta(o)}}}}getDrawFPS(){return function(){let s=performance.now(),o=s-vr,l=Ct,f=1e3*Ve/o,u=Ve;return Ct=0,Ve=0,vr=s,{avg:l,real_fps:f,virtual_fps:1e3/l,num_frames:u,elapsed:o}}()}async scrollToCell(s,o,l,f){let u=this._virtual_panel.offsetHeight/f;this.scrollTop=u*o,this.scrollLeft=s/(this._max_scroll_column(l)||l)*(this.scrollWidth-this.clientWidth),await this.draw.flush()}setDataListener(s,{virtual_mode:o="both"}={}){console.assert(rn.indexOf(o)>-1,`Unknown virtual_mode ${o};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=o,this._invalid_schema=!0,this._view_cache={view:s,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",zr);var Or=Tt(Nr());var Be=Tt($t()),me=Symbol("Plugin Symbol");function mt(t){let[s,o,l]=t.rgb(),[f,u,p]=t.set("hsl.h",(t.get("hsl.h")-15)%360).rgb(),[v,_,y]=t.set("hsl.h",(t.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${f},${u},${p}),rgb(${s},${o},${l}) 50%,rgb(${v},${_},${y}))`}function Xt(t,s,o){let l=typeof o!="undefined",f=document.createElement(`perspective-${l?"number":"string"}-column-style`),u=t.getMeta(s),p=u.column_header[u.column_header.length-1],v=this._schema[p],_;if(l?_={gradient:o,pos_color:this._pos_color[0],neg_color:this._neg_color[0],number_color_mode:"foreground"}:_={color:this._color[0]},v!=="string")if(v==="float")_.fixed=2;else if(v==="integer")_.fixed=0;else{this._open_column_styles_menu.pop(),t.draw({preserve_width:!0});return}let y=()=>f.blur(),w=G=>{let M=G.detail;M.pos_color&&(M.pos_color=[M.pos_color,...(0,Be.default)(M.pos_color).rgb(),mt((0,Be.default)(M.pos_color))],M.neg_color=[M.neg_color,...(0,Be.default)(M.neg_color).rgb(),mt((0,Be.default)(M.neg_color))]),M.color&&(M.color=[M.color,...(0,Be.default)(M.color).rgb(),mt((0,Be.default)(M.color))]),t[me]=t[me]||{},t[me][p]=M,t.draw({preserve_width:!0}),t.parentElement.dispatchEvent(new Event("perspective-config-update"))},E=async()=>{t.removeEventListener("regular-table-scroll",y),f.removeEventListener("perspective-column-style-change",w),f.removeEventListener("blur",E),f.destroy(),this._open_column_styles_menu.pop(),await t.draw({preserve_width:!0}),t.parentElement.dispatchEvent(new Event("perspective-config-update"))};f.addEventListener("perspective-column-style-change",w),f.addEventListener("blur",E),t.addEventListener("regular-table-scroll",y);let S=t[me]||{},W=Object.assign({},S[p]=S[p]||{});W.pos_color&&(W.pos_color=W.pos_color[0],W.neg_color=W.neg_color[0]),W.color&&(W.color=W.color[0]),f.open(s,W,_)}function bt([t,s,o,l],f=[255,255,255]){function u(p,v){return((1-l)*(f[p]/255)+l*(v/255))*255}return[u(0,t),u(1,s),u(2,o)]}function vt([t,s,o]){return Math.sqrt(t*t*.299+s*s*.587+o*o*.114)>130?"#161616":"#ffffff"}var wt=Tt($t());function nn(t){let s=t._view_cache.config.row_pivots.length-1,o=Array.from(t.children[0].children[0].children),l=t[me]||{};if(o.length>0){let[v]=o.splice(o.length-1,1);for(let _ of v?.children){let y=t.getMeta(_),w=y.column_header?.[y.column_header?.length-1],E=this._config.sort.find(I=>I[0]===w),S=y.row_header_x===s,W=typeof y.x=="undefined";S=S||(y.x+1)%this._config.columns.length==0,_.classList.toggle("psp-header-border",S),_.classList.toggle("psp-header-group",!1),_.classList.toggle("psp-header-leaf",!0),_.classList.toggle("psp-is-top",!1),_.classList.toggle("psp-header-corner",W),_.classList.toggle("psp-header-sort-asc",!!E&&E[1]==="asc"),_.classList.toggle("psp-header-sort-desc",!!E&&E[1]==="desc"),_.classList.toggle("psp-header-sort-col-asc",!!E&&E[1]==="col asc"),_.classList.toggle("psp-header-sort-col-desc",!!E&&E[1]==="col desc");let G=Kt.call(this,y),M=G==="integer"||G==="float",C=G==="string";_.classList.toggle("psp-align-right",M),_.classList.toggle("psp-align-left",!M),_.classList.toggle("psp-menu-open",this._open_column_styles_menu[0]===y._virtual_x),_.classList.toggle("psp-menu-enabled",(C||M)&&!W),_.classList.toggle("psp-is-width-override",t._column_sizes?.override[y.size_key]!==void 0)}}let f=[],u=new Set,p=t.children[0];for(let v=0;v<o.length;v++){let _=p.rows[v],y=new Set;for(let w=0;w<_.cells.length;w++){let E=_.cells[w];E.style.backgroundColor="";let S=t.getMeta(E),W=S.row_header_x===s||S.x>=0;E.classList.toggle("psp-align-right",!1),E.classList.toggle("psp-align-left",!1),E.classList.toggle("psp-header-group",!0),E.classList.toggle("psp-header-leaf",!1),E.classList.toggle("psp-header-border",W),E.classList.toggle("psp-header-group-corner",typeof S.x=="undefined"),E.classList.toggle("psp-color-mode-bar",!1),E.classList.toggle("psp-header-sort-asc",!1),E.classList.toggle("psp-header-sort-desc",!1),E.classList.toggle("psp-header-sort-col-asc",!1),E.classList.toggle("psp-header-sort-col-desc",!1);let G=_.cells[w],M=w,C,I;for(;f[v]&&f[v][M];++M);for(y.add(M),C=M;C<M+G.colSpan;++C)for(I=v;I<v+G.rowSpan;++I)f[I]||(f[I]=[]),f[I][C]=!0;G.classList.toggle("psp-is-top",v===0||!u.has(C))}u=y}for(let v of t.children[0].children[1].children)for(let _ of v.children){let y=t.getMeta(_),w=y.column_header?.[y.column_header?.length-1],E=Kt.call(this,y),S=l[w],W=E==="integer"||E==="float";if(W){let M=y.user>0,C=y.user<0,[I,Q,g,$,oe]=(()=>S?.pos_color!==void 0?M?S.pos_color:C?S.neg_color:["",0,0,0,""]:M?this._pos_color:C?this._neg_color:["",0,0,0,""])();if(_.style.position="",S?.number_color_mode==="background"){let P=this._plugin_background,D=vt(bt([Q,g,$,1],P));_.style.color=D,_.style.backgroundColor=I}else if(S?.number_color_mode==="gradient"){let P=Math.max(0,Math.min(1,Math.abs(y.user/S.gradient))),D=this._plugin_background,re=vt(bt([Q,g,$,P],D));_.style.color=re,_.style.backgroundColor=`rgba(${Q},${g},${$},${P})`}else S?.number_color_mode==="disabled"?(_.style.backgroundColor="",_.style.color=""):S?.number_color_mode==="bar"?(_.style.backgroundColor="",_.style.color="",_.style.position="relative",oe!==""&&_.children.length>0&&_.children[0].nodeType===Node.ELEMENT_NODE&&(_.children[0].style.background=oe)):(_.style.backgroundColor="",_.style.color=I)}else if(E==="boolean"){let[M]=y.user===!0?this._pos_color:y.user===!1?this._neg_color:["",0,0,0,""];_.style.backgroundColor="",_.style.color=M}else if(E==="string"){let[M,C,I,Q,g]=(()=>S?.color!==void 0?S.color:this._color)();if(S?.string_color_mode==="foreground"&&y.user!==null)_.style.color=M,_.style.backgroundColor="",S?.format==="link"&&(_.children[0].style.color=M);else if(S?.string_color_mode==="background"&&y.user!==null){let $=this._plugin_background,oe=vt(bt([C,I,Q,1],$));_.style.color=oe,_.style.backgroundColor=M}else if(S?.string_color_mode==="series"&&y.user!==null){this._series_color_map.has(w)||(this._series_color_map.set(w,new Map),this._series_color_seed.set(w,0));let $=this._series_color_map.get(w);if(!$.has(y.user)){let Ae=this._series_color_seed.get(w);$.set(y.user,Ae),this._series_color_seed.set(w,Ae+1)}let oe=$.get(y.user),[P,D,re]=(0,wt.default)(M).hsl();P=P+oe*150%360;let se=(0,wt.default)(P,D,re,"hsl"),[fe,ae,xe]=se.rgb(),Pe=se.hex(),ke=this._plugin_background,Ie=vt(bt([fe,ae,xe,1],ke));_.style.color=Ie,_.style.backgroundColor=Pe}else _.style.backgroundColor="",_.style.color=""}else _.style.backgroundColor="",_.style.color="";_.classList.toggle("psp-bool-type",E==="boolean"&&y.user!==null);let G=_.tagName==="TH";if(G){let M=typeof y.value!=null&&typeof y.value!=null&&y.value?.toString()?.trim().length>0,C=y.row_header_x>=this._config.row_pivots.length,I=t.getMeta({dx:0,dy:y.y-y.y0+1}),Q=I&&I.row_header&&typeof I.row_header[y.row_header_x+1]!="undefined";_.classList.toggle("psp-tree-label",M&&!C),_.classList.toggle("psp-tree-label-expand",M&&!C&&!Q),_.classList.toggle("psp-tree-label-collapse",M&&!C&&Q),_.classList.toggle("psp-tree-leaf",M&&C)}_.classList.toggle("psp-align-right",!G&&W),_.classList.toggle("psp-align-left",G||!W),_.classList.toggle("psp-color-mode-bar",S?.number_color_mode==="bar"&&W)}}async function sn(t,s,o){let l=t.getMeta(o),f=l.column_header[l.column_header.length-1],p=(s.shiftKey?on:an).call(this,f);t.dispatchEvent(new CustomEvent("regular-table-psp-sort",{detail:{sort:p}}))}function on(t){let s=[],o=!1;for(let l of this._config.sort){let[f,u]=l;if(f===t){o=!0;let p=Ar.call(this,t,u);p&&s.push(p)}else s.push(l)}return o||s.push([t,"desc"]),s}function an(t){for(let[s,o]of this._config.sort)if(s===t){let l=Ar.call(this,t,o);return l?[l]:[]}return[[t,"desc"]]}function Ar(t,s){let l=this._config.column_pivots.length>0?cn:ln,f=s?l[s]:"desc";if(f)return[t,f]}var ln={desc:"asc",asc:void 0},cn={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function fn(t,s){let o=t.getMeta(s.target),l=s.target.classList.contains("psp-tree-label-collapse");s.shiftKey&&l?this._view.set_depth(o.row_header.filter(f=>f!==void 0).length-2):s.shiftKey?this._view.set_depth(o.row_header.filter(f=>f!==void 0).length-1):l?this._view.collapse(o.y):this._view.expand(o.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),t.draw()}async function dn(t,s){if(s.which!==1)return;let o=s.target;if(o.tagName==="A")return;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!t.contains(o))return;if(o.classList.contains("psp-tree-label")&&s.offsetX<26){fn.call(this,t,s),s.stopImmediatePropagation();return}let l=o.getBoundingClientRect();if(o.classList.contains("psp-menu-enabled")&&s.clientY-l.top>16){let f=t.getMeta(o),u=f.column_header?.[f.column_header?.length-1],p=this._schema[u];if(this._open_column_styles_menu.unshift(f._virtual_x),p==="string")t.draw({preserve_width:!0}),Xt.call(this,t,o);else{let[,v]=await this._view.get_min_max(u);t.draw({preserve_width:!0}),Xt.call(this,t,o,v)}s.preventDefault(),s.stopImmediatePropagation()}else o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner")&&(sn.call(this,t,s,o),s.stopImmediatePropagation())}function un(t,s){if(s.which!==1)return;let o=s.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!t.contains(o))return;(o.classList.contains("psp-tree-label")&&s.offsetX<26||o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner"))&&s.stopImmediatePropagation()}var Ye={},Vt={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(t){return t?"check":"close"}}},Sr=Ye;function Fr(t,s,o={},l=!1){if(s===null)return"-";let f=t[t.length-1],u=l&&this._table_schema[f]||this._schema[f]||"string",p=o[f],v=u==="integer"||u==="float";if(v&&p?.number_color_mode==="bar"){let _=Math.max(0,Math.min(.95,Math.abs(s/p.gradient)*.95)),y=this._div_factory.get(),w=s>=0?"left":"right";return y.setAttribute("style",`width:${(_*100).toFixed(2)}%;position:absolute;${w}:0;height:80%;top:10%;pointer-events:none;`),y}else if(p?.format==="link"&&u==="string"){let _=document.createElement("a");return _.setAttribute("href",s),_.setAttribute("target","_blank"),_.textContent=s,_}else if(p?.format==="bold"&&u==="string"){let _=document.createElement("b");return _.textContent=s,_}else if(p?.format==="italics"&&u==="string"){let _=document.createElement("i");return _.textContent=s,_}else{let _=v&&p&&p.fixed!==void 0,y=_?`${u}${p.fixed}`:u;if(Ye[y]===void 0){let w=(0,Or.get_type_config)(u);if(_){let E={minimumFractionDigits:p.fixed,maximumFractionDigits:p.fixed};Ye[y]=new Vt[u]("en-us",E)}else Vt[u]?Ye[y]=new Vt[u]("en-us",w.format):Ye[y]=!1}return Ye[y]?Ye[y].format(s):s}}function*hn(t=[],s,o){let l=o[me];for(let f of t){f=["TOTAL",...f];let u=f[f.length-1];f=f.slice(0,f.length-1).fill("");let p=Fr.call(this,[s[f.length-1]],u,l,!0);p instanceof HTMLElement?f=f.concat(p):f=f.concat({toString:()=>p}),f.length=s.length+1,yield f}}async function _n(t,s,o,l,f){let u={};l-s>0&&f-o>0?(u=await this._view.to_columns({start_row:o,start_col:s,end_row:f,end_col:l,id:!0}),this._ids=u.__ID__):this._div_factory.clear();let p=[],v=[],_=[];for(let y of this._column_paths.slice(s,l)){let w=y.split("|"),E=u[y]||new Array(f-o).fill(null);p.push(E.map(S=>Fr.call(this,w,S,t[me]))),v.push(E),_.push(w)}return{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(hn.call(this,u.__ROW_PATH__,this._config.row_pivots,t)),column_headers:_,data:p,metadata:v}}function St(t,s,o){let l=window.getComputedStyle(t).getPropertyValue(s).trim();return l.length>0?l:o}var jr=class{constructor(s){this._name=s,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let s=this._elements[this._index];return this._index+=1,s}};function $e(t){let s=(0,wt.default)(t),o=mt(s);return[t,...s.rgb(),o]}async function Ut(t,s,o,l={}){let f=await o.get_config(),u=f.expressions.map(P=>P[1]),[p,v,_,y,w,E]=await Promise.all([s.schema(),s.validate_expressions(u),o.num_rows(),o.schema(),o.expression_schema(),o.column_paths()]),S=(0,wt.default)(St(t,"--plugin--background","#FFFFFF")).rgb(),W=$e(St(t,"--rt-pos-cell--color","#338DCD")),G=$e(St(t,"--rt-neg-cell--color","#FF5942")),M=$e(St(t,"--active--color","#ff0000")),C={...y,...w},I={...p,...v.expression_schema},Q=E.filter(P=>P!=="__ROW_PATH__"&&P!=="__ID__"),g=[],$=[];for(let P of Q){let D=P.split("|"),re=D[D.length-1];$.push(C[re]),g.push(!!p[re])}let oe=Object.assign(l,{_view:o,_table:s,_table_schema:I,_config:f,_num_rows:_,_schema:C,_ids:[],_open_column_styles_menu:[],_plugin_background:S,_color:M,_pos_color:W,_neg_color:G,_column_paths:Q,_column_types:$,_is_editable:g,_row_header_types:f.row_pivots.map(P=>I[P]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Kt});return oe._div_factory=oe._div_factory||new jr("div"),t.setDataListener(_n.bind(oe,t),{virtual_mode:t.parentElement.virtual_mode||"both"}),oe}function Kt(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}async function Pr(t,s){t.addStyleListener(nn.bind(s,t)),t.addEventListener("mousedown",dn.bind(s,t)),t.addEventListener("click",un.bind(s,t)),await t.draw()}var Ir=`regular-table{padding:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}regular-table{font-family:"Open Sans"}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0px}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #ddd}regular-table th{position:relative}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:"Material Icons"}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:"Material Icons"}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px #1a7da1}regular-table .rt-selected td{background-color:#eee}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.rt-group-name{text-align:left}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table a{color:var(--rt-pos-cell--color)}regular-table a:visited{color:var(--active--color)}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#0000;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:#00000026}regular-table::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0 var(--pv-divider--color, #eaedef)}.psp-header-group{box-shadow:0 10px 0 -9px var(--pv-divider--color, #eaedef)}.psp-is-top{box-shadow:5px 4px 0 -4px var(--pv-divider--color, #eaedef)}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0 -4px var(--pv-divider--color, #eaedef),0 10px 0 -9px var(--pv-divider--color, #eaedef)}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0 var(--pv-divider--color, #eaedef),0 10px 0 -9px var(--pv-divider--color, #eaedef)}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0 -4px var(--pv-divider--color, #eaedef)}tr:only-child th{box-shadow:none!important}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--rt-hover--border-color, #c5c9d080)!important;background-color:transparent;box-shadow:0 1px 0 var(--rt-hover--border-color, #c5c9d080),0 3px #0000000d,0 5px #00000003}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:1px;border-right-color:transparent}regular-table tbody tr:hover{color:#161616}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color, #c5c9d080)!important}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color, #c5c9d080)!important}perspective-viewer[settings] regular-table .psp-header-leaf{height:36px;vertical-align:top;padding-top:2px}perspective-viewer[settings] regular-table .psp-header-leaf:not(.psp-header-corner):before{font-family:"Material Icons";content:"menu";position:absolute;width:calc(100% - 8px);left:5px;bottom:0px;color:var(--inactive--color, #b4b7be)}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:not(.psp-header-corner):before{color:inherit;cursor:pointer}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner){pointer-events:none}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner):before{content:"expand_less"}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:hover:before{color:#338dcd}perspective-viewer[settings] regular-table .psp-header-leaf .rt-column-resize{height:18px}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:#fff!important;background-color:#ea7319!important;border-color:#ea7319!important}.psp-row-selected.psp-tree-label:not(:hover):before{color:#fff}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,.2)!important}.psp-error{color:red}td:focus{outline:#666;outline-style:dotted;outline-width:1px}perspective-viewer.dragging regular-table{pointer-events:none}.psp-header-border:last-child{border-right-width:0px}.psp-header-sort-desc:after{font-family:"Material Icons";font-size:10px;content:"arrow_downward"}.psp-header-sort-asc:after{font-family:"Material Icons";font-size:10px;content:"arrow_upward"}.psp-header-sort-col-desc:after{font-family:"Material Icons";font-size:10px;content:"arrow_back"}.psp-header-sort-col-asc:after{font-family:"Material Icons";font-size:10px;content:"arrow_forward"}tbody th:last-of-type{border-right:1px solid #eaedef;overflow:hidden;text-overflow:ellipsis}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,#eee 10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none}.psp-tree-label{max-width:0px;min-width:0px}.psp-tree-label:before{color:#ccc;font-family:"Material Icons";padding-right:11px;vertical-align:-1px}.psp-tree-label-expand:before{content:"add"}.psp-tree-label-collapse:before{content:"remove"}.psp-tree-label:hover:before{color:#338dcd;text-shadow:0px 0px 5px #338dcd}regular-table thead tr:last-child th{border-bottom-width:0px}.psp-tree-leaf{padding-left:24px}.psp-align-right{text-align:right}.psp-align-left{text-align:left}.psp-positive:not(:focus){color:var(--rt-pos-cell--color, #338dcd)}.psp-negative:not(:focus){color:var(--rt-neg-cell--color, #ff5942)}regular-table table tbody td{min-width:52px!important}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed #999;border-bottom-width:0px;border-left-width:0px}.psp-bool-type{font-family:"Material Icons"}.boolean-editable{cursor:pointer}regular-table table{user-select:none;color:#161616;border-collapse:separate}regular-table table th{font-weight:400}regular-table table td,regular-table table th{border-color:#eaedef;height:23px}regular-table table .psp-header-group{text-overflow:ellipsis}regular-table table .psp-header-leaf{border-bottom-width:0px}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px}regular-table table tbody th:empty{background-position:0px -10px}
`;async function yt({_view:t,_config:s},o,l){let f=s.row_pivots,u=s.column_pivots,p=o>=0?o:0,v=p+1,_=await t.to_json({start_row:p,end_row:v}),w=_.map(I=>I.__ROW_PATH__)[0]||[],E=f.map((I,Q)=>{let g=w[Q];return g?[I,"==",g]:void 0}).filter(I=>I),S=f.length>0?l+1:l,W=Object.keys(_[0])[S],G={row:_[0]},M=[];if(W){let I=W.split("|");G.column_names=[I[I.length-1]],M=u.map((Q,g)=>{let $=I[g];return $?[Q,"==",$]:void 0}).filter(Q=>Q).filter(([,,Q])=>Q!=="__ROW_PATH__")}let C=s.filter.concat(E).concat(M);return G.config={filter:C},G}var Ue=new WeakMap;async function gn(t,s,o){let l=t.getMeta(o.target);if(!s.hasAttribute("selectable")||o.handled||o.which!==1||!l)return;let f=this._ids[l.y-l.y0];if(l&&l.y>=0){let u=Ue.get(t),p=!!u&&u.reduce((y,w,E)=>y&&w===f[E],!0),v=!!u&&f.length===u.length&&p,_=[];v?Ue.delete(t):(Ue.set(t,f),_=await yt(this,l.y,l.x),_=_.config.filter),await t.draw({preserve_width:!0}),o.handled=!0,s.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:!v,config:{filter:_}}}))}}function mn(t,s){if(!s.hasAttribute("selectable"))return;let o=Ue.has(t),l=Ue.get(t);for(let f of t.querySelectorAll("td"))if(!o)f.classList.toggle("psp-row-selected",!1),f.classList.toggle("psp-row-subselected",!1);else{let u=t.getMeta(f),p=this._ids[u.y-u.y0],v=l.reduce((_,y,w)=>_&&y===p[w],!0);f.classList.toggle("psp-row-selected",p.length===l.length&&v),f.classList.toggle("psp-row-subselected",p.length!==l.length&&v)}for(let f of t.querySelectorAll("tbody th")){let u=t.getMeta(f),p=this._ids[u.y-u.y0];if(!o||!!p[u.row_header_x])f.classList.toggle("psp-row-selected",!1),f.classList.toggle("psp-row-subselected",!1);else{let v=l.reduce((_,y,w)=>_&&y===p[w],!0);f.classList.toggle("psp-row-selected",p.length===l.length&&v),f.classList.toggle("psp-row-subselected",p.length!==l.length&&v)}}}function Rr(t,s){t.addStyleListener(mn.bind(this,t,s)),t.addEventListener("mousedown",gn.bind(this,t,s))}async function Wr(t){Ue.delete(t);for(let s of t.querySelectorAll("td,th"))s.classList.toggle("psp-row-selected",!1),s.classList.toggle("psp-row-subselected",!1)}async function bn(t,s,o){let l=t.getMeta(o.target);if(!l)return;let{x:f,y:u}=l,{row:p,column_names:v,config:_}=await yt(this,u,f);s.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:p,column_names:v,config:_}}))}function Dr(t,s){t.addEventListener("click",bn.bind(this,t,s))}var Xe=new WeakMap;function vn(t){let s;return async function(...o){if(!!s&&await s&&!!s)return;let l;s=new Promise(f=>l=f),await t.apply(this,o),s=void 0,l()}}function Hr(){if(this.isContentEditable){let t=document.getSelection().getRangeAt(0),s=t.cloneRange();return s.selectNodeContents(this),s.setEnd(t.endContainer,t.endOffset),s.toString().length}else return this.target.selectionStart}function Tr(t,s,o){let l=t.getMeta(o),f=s._schema[s._column_paths[l.x]];if(l){let u=o.textContent,p=s._ids[l.y-l.y0];if(f==="float"||f==="integer"){if(u=parseFloat(u.replace(/,/g,"")),isNaN(u))return!1}else if(f==="date"||f==="datetime"){if(u=Date.parse(u),isNaN(u))return!1}else f==="boolean"&&(u=u==="check"?!1:u==="close"?!0:null);let v={__INDEX__:p,[s._column_paths[l.x]]:u};return s._table.update([v],{port_id:s._edit_port}),!0}}function Jt(t){let s=this._config.row_pivots.length===0&&this._config.column_pivots.length===0,o=t.hasAttribute("selectable"),l=t.hasAttribute("editable");return s&&!o&&l}var Ke=vn(async function(t,s,o,l){let f=t.getMeta(s),u=this._column_paths.length,p=this._num_rows,v=Xe.get(t);if(!v)return;f.x+o<u&&0<=f.x+o&&(v.x=f.x+o),f.y+l<p&&0<=f.y+l&&(v.y=f.y+l);let _=Math.max(f.x0-10,0),y=Math.min(f.x0+10,u),w=Math.max(f.y0-5,0),E=Math.min(f.y0+10,p),S=f.x0+o,W=f.y0+l;for(;!Gr(t)&&S>=_&&S<y&&W>=w&&W<E;)await t.scrollToCell(S,W,u,p),Xe.set(t,v),S+=o,W+=l});function wn(t,s){if(!s.hasAttribute("editable"))return;let o=t[me]||{},l=Jt.call(this,s);for(let f of t.querySelectorAll("td")){let u=t.getMeta(f),p=this.get_psp_type(u);if(this._is_editable[u.x]){let v=u.column_header[u.column_header.length-1];p==="string"&&o[v]?.format==="link"?(f.toggleAttribute("contenteditable",!1),f.classList.toggle("boolean-editable",!1)):p==="boolean"?(f.toggleAttribute("contenteditable",!1),f.classList.toggle("boolean-editable",u.user!==null)):(f.toggleAttribute("contenteditable",l),f.classList.toggle("boolean-editable",!1))}else f.toggleAttribute("contenteditable",!1),f.classList.toggle("boolean-editable",!1)}}var Gr=t=>{let s=t.querySelectorAll("td"),o=Xe.get(t);if(o){for(let l of s){let f=t.getMeta(l);if(f.x===o.x&&f.y===o.y)return document.activeElement!==l&&l.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&t.contains(document.activeElement)&&document.activeElement.blur()}};function yn(t,s,o){if(!Jt.call(this,s))return;let l=document.activeElement;switch(o.target.classList.remove("psp-error"),o.keyCode){case 13:o.preventDefault(),o.shiftKey?Ke.call(this,t,l,0,-1):Ke.call(this,t,l,0,1);break;case 37:Hr.call(l)==0&&(o.preventDefault(),Ke.call(this,t,l,-1,0));break;case 38:o.preventDefault(),Ke.call(this,t,l,0,-1);break;case 39:Hr.call(l)==l.textContent.length&&(o.preventDefault(),Ke.call(this,t,l,1,0));break;case 40:o.preventDefault(),Ke.call(this,t,l,0,1);break;default:}}function xn(t,s,o){if(Jt.call(this,s)&&Xe.has(t)){o.target.classList.remove("psp-error");let l=Xe.get(t);Xe.delete(t),l.content!==o.target.textContent&&(Tr(t,this,o.target)||(o.target.textContent=l.content,o.target.classList.add("psp-error"),o.target.focus()))}}function kn(t,s,o){let l=t.getMeta(o.target);if(l){let f={x:l.x,y:l.y,content:o.target.textContent};Xe.set(t,f)}}function Ln(t,s,o){let l=t.getMeta(o.target);if(typeof l?.x!="undefined"){let f=this._is_editable[l.x],u=this.get_psp_type(l)==="boolean",p=o.target.textContent==="-";f&&u&&!p&&Tr(t,this,o.target)}}async function qr(t,s){this._edit_port=await s.getEditPort(),t.addStyleListener(wn.bind(this,t,s)),t.addStyleListener(Gr.bind(this,t,s)),t.addEventListener("click",Ln.bind(this,t,s)),t.addEventListener("focusin",kn.bind(this,t,s)),t.addEventListener("focusout",xn.bind(this,t,s)),t.addEventListener("keydown",yn.bind(this,t,s))}async function Br(t,s){t.addEventListener("regular-table-psp-sort",o=>{this._preserve_focus_state=!0,s.restore({sort:o.detail.sort})})}customElements.define("perspective-viewer-datagrid",class extends HTMLElement{constructor(){super();this.datagrid=document.createElement("regular-table"),this.datagrid.formatters=Sr}async activate(t){let s=this.parentElement,o=await s.getTable(!0);this._initialized?await Ut(this.datagrid,o,t,this.model):(this.innerHTML="",this.appendChild(this.datagrid),this.model=await Ut(this.datagrid,o,t),Pr(this.datagrid,this.model),await Rr.call(this.model,this.datagrid,s),await Dr.call(this.model,this.datagrid,s),await qr.call(this.model,this.datagrid,s),await Br.call(this.model,this.datagrid,s),this._initialized=!0)}get name(){return"Datagrid"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){}async draw(t){let s=this._save_column_size_overrides();await this.activate(t);let o=this.parentElement,l=this.datagrid.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.datagrid.scrollTop=0,this.datagrid.scrollLeft=0,Wr(this.datagrid,o),this.datagrid._resetAutoSize()),this._restore_column_size_overrides(s),await l}async update(t){this.model._num_rows=await t.num_rows(),await this.datagrid.draw()}async resize(){this._initialized&&await this.datagrid.draw()}async clear(){this.datagrid._resetAutoSize(),this.datagrid.clear()}save(){if(this.datagrid){let t=this.datagrid,s={};for(let l of Object.keys(t[me]||{})){let f=Object.assign({},t[me][l]);f?.pos_color&&(f.pos_color=f.pos_color[0],f.neg_color=f.neg_color[0]),f?.color&&(f.color=f.color[0]),s[l]=f}let o=this._save_column_size_overrides();for(let l of Object.keys(o||{}))s[l]||(s[l]={}),s[l].column_size_override=o[l];return JSON.parse(JSON.stringify(s))}return{}}restore(t){t=JSON.parse(JSON.stringify(t));let s={};for(let l of Object.keys(t)){let f=t[l];f.column_size_override!==void 0&&(s[l]=f.column_size_override,delete f.column_size_override),f?.pos_color&&(f.pos_color=$e(f.pos_color),f.neg_color=$e(f.neg_color)),f?.color&&(f.color=$e(f.color)),Object.keys(f).length===0&&delete t[l]}let o=this.datagrid;try{o._resetAutoSize()}catch{}this._restore_column_size_overrides(s,!0),o[me]=t}async restyle(){}delete(){this.datagrid.table_model&&this.datagrid._resetAutoSize(),this.datagrid.clear()}_save_column_size_overrides(){if(!this._initialized)return[];if(this._cached_column_sizes){let u=this._cached_column_sizes;return this._cached_column_sizes=void 0,u}let t=this.datagrid._column_sizes.override,{row_pivots:s,columns:o}=this.model._config,l=s?.length>0?s.length+1:0,f={};for(let u of Object.keys(t))if(t[u]!==void 0){let p=u-l;p>-1&&(f[this.model._column_paths[p]]=t[u])}return f}_restore_column_size_overrides(t,s=!1){if(!this._initialized)return;s&&(this._cached_column_sizes=t);let o={},{row_pivots:l,columns:f}=this.model._config,u=l?.length>0?l.length+1:0;for(let p of Object.keys(t)){let v=this.model._column_paths.indexOf(p);o[v+u]=t[p]}this.datagrid._column_sizes.override=o}});function zn(){let t=document.createElement("style");t.textContent=Ir,document.head.insertBefore(t,document.head.firstChild)}function Mn(){customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}customElements.whenDefined("perspective-viewer").then(Mn);zn();})();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
//# sourceMappingURL=perspective-viewer-datagrid.js.map
